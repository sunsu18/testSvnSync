<?xml version = "1.0" encoding = "UTF-8" ?>
<!--
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  Oracle JDeveloper BPEL Designer 
  
  Created: Tue May 06 16:00:27 IST 2014
  Author:  10602239
  Type: BPEL 1.1 Process
  Purpose: One Way BPEL Process
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
-->
<process name="E004AccountPALStoPortal"
               targetNamespace="http://www.statoilfuelretail.com/integration/engage/E004AccountPALStoPortal/E004AccountPALStoPortal/E004AccountPALStoPortal"
               xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
               xmlns:client="http://www.statoilfuelretail.com/integration/engage/E004AccountPALStoPortal/E004AccountPALStoPortal/E004AccountPALStoPortal"
               xmlns:ora="http://schemas.oracle.com/xpath/extension"
               xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
         xmlns:bpelx="http://schemas.oracle.com/bpel/extension"
         xmlns:bpel2="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:ns1="http://xmlns.oracle.com/pcbpel/adapter/db/E004AccountPALStoPortal/E004AccountPALStoPortal/SelectDeltaTSDBAdapter"
         xmlns:ns2="http://xmlns.oracle.com/pcbpel/adapter/db/top/SelectDeltaTSDBAdapter"
         xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20"
         xmlns:aia="http://www.oracle.com/XSL/Transform/java/oracle.apps.aia.core.xpath.AIAFunctions"
         xmlns:oraext="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns:dvm="http://www.oracle.com/XSL/Transform/java/oracle.tip.dvm.LookupValue"
         xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath"
         xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath"
         xmlns:bpm="http://xmlns.oracle.com/bpmn20/extensions"
         xmlns:xdk="http://schemas.oracle.com/bpel/extension/xpath/function/xdk"
         xmlns:xref="http://www.oracle.com/XSL/Transform/java/oracle.tip.xref.xpath.XRefXPathFunctions"
         xmlns:ldap="http://schemas.oracle.com/xpath/extension/ldap"
         xmlns:xsd="http://www.w3.org/2001/XMLSchema"
         xmlns:ns3="http://xmlns.oracle.com/pcbpel/adapter/db/E004AccountPALStoPortal/E004AccountPALStoPortal/GetPALSDB2CountDBAdapter"
         xmlns:ns4="http://xmlns.oracle.com/pcbpel/adapter/db/GetPALSDB2CountDBAdapter"
         xmlns:ns5="http://xmlns.oracle.com/pcbpel/adapter/db/E004AccountPALStoPortal/E004AccountPALStoPortal/PALSDB2DBAdapter"
         xmlns:ns6="http://xmlns.oracle.com/pcbpel/adapter/db/PALSDB2DBAdapter"
         xmlns:ns7="http://xmlns.oracle.com/pcbpel/adapter/db/E004AccountPALStoPortal/E004AccountPALStoPortal/MergeDeltaTSSOADBAdapterV1"
         xmlns:ns8="http://xmlns.oracle.com/pcbpel/adapter/db/top/MergeDeltaTSSOADBAdapterV1"
         xmlns:ns9="http://xmlns.oracle.com/pcbpel/adapter/db/top/PALSDB2DBAdapter"
         xmlns:ns10="http://www.statoilfuelretail.com/integration/engage"
         xmlns:ns11="http://xmlns.oracle.com/pcbpel/adapter/db/E004AccountPALStoPortal/E004AccountPALStoPortal/SOAErrorDBAdapter"
         xmlns:ns12="http://xmlns.oracle.com/pcbpel/adapter/db/E004AccountPALStoPortal/E004AccountPALStoPortal/PartnerPortalDBAdapter"
         xmlns:ns13="http://xmlns.oracle.com/pcbpel/adapter/db/E004AccountPALStoPortal/E004AccountPALStoPortal/MergeAccountPortalDBAdapter"
         xmlns:ns14="http://xmlns.oracle.com/pcbpel/adapter/db/top/PartnerPortalDBAdapter"
         xmlns:ns15="http://xmlns.oracle.com/pcbpel/adapter/db/top/MergeAccountPortalDBAdapter"
         xmlns:ns16="http://xmlns.oracle.com/pcbpel/adapter/db/top/SOAErrorDBAdapter"
         xmlns:ns17="http://xmlns.oracle.com/pcbpel/adapter/db/E004AccountPALStoPortal/E004AccountPALStoPortal/InsertPALSDataToTempAccountPortalDBAdapter"
         xmlns:ns18="http://xmlns.oracle.com/pcbpel/adapter/db/E004AccountPALStoPortal/E004AccountPALStoPortal/SelectValidDataTempAccountPortalDBAdapter"
         xmlns:ns19="http://xmlns.oracle.com/pcbpel/adapter/db/E004AccountPALStoPortal/E004AccountPALStoPortal/SelectInValidDataTempAccountPortalDBAdapter"
         xmlns:ns20="http://xmlns.oracle.com/pcbpel/adapter/db/E004AccountPALStoPortal/E004AccountPALStoPortal/TruncateTempAccountPortalDBAdapter"
         xmlns:ns21="http://www.statoilfuelretail.com/integration/engage/ErrorHandling.xsd"
         xmlns:ns22="http://xmlns.oracle.com/pcbpel/adapter/jms/E004AccountPALStoPortal/E004AccountPALStoPortal/SOAErrorHandlerJMSAdapter"
         xmlns:ns23="http://xmlns.oracle.com/pcbpel/adapter/db/E004AccountPALStoPortal/E004AccountPALStoPortal/SOAErrorLogDBAdapter"
         xmlns:ns24="http://xmlns.oracle.com/pcbpel/adapter/db/top/SOAErrorLogDBAdapter"
         xmlns:ns25="http://xmlns.oracle.com/pcbpel/adapter/db/E004AccountPALStoPortal/E004AccountPALStoPortal/UpdateSOAErrorDBAdapter">

  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      PARTNERLINKS                                                      
      List of services participating in this BPEL process               
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  --> 
  <partnerLinks>
    <!-- 
      The 'client' role represents the requester of this service. It is 
      used for callback. The location and correlation information associated
      with the client role are automatically set using WS-Addressing.
    -->
    <partnerLink name="e004accountpalstoportal_client" partnerLinkType="client:E004AccountPALStoPortal" myRole="E004AccountPALStoPortalProvider"/>
    <partnerLink name="SelectDeltaTSDBAdapter"
                 partnerLinkType="ns1:SelectDeltaTSDBAdapter_plt"
                 partnerRole="SelectDeltaTSDBAdapter_role"/>
    <partnerLink name="GetPALSDB2CountDBAdapter"
                 partnerLinkType="ns3:GetPALSDB2CountDBAdapter_plt"
                 partnerRole="GetPALSDB2CountDBAdapter_role"/>
    <partnerLink name="MergeDeltaTSSOADBAdapterV1"
                 partnerLinkType="ns7:MergeDeltaTSSOADBAdapterV1_plt"
                 partnerRole="MergeDeltaTSSOADBAdapterV1_role"/>
    <partnerLink name="PALSDB2DBAdapter"
                 partnerLinkType="ns5:PALSDB2DBAdapter_plt"
                 partnerRole="PALSDB2DBAdapter_role"/>
    <partnerLink name="SOAErrorDBAdapter"
                 partnerLinkType="ns11:SOAErrorDBAdapter_plt"
                 partnerRole="SOAErrorDBAdapter_role"/>
    <partnerLink name="MergeAccountPortalDBAdapter"
                 partnerLinkType="ns13:MergeAccountPortalDBAdapter_plt"
                 partnerRole="MergeAccountPortalDBAdapter_role"/>
    <partnerLink name="InsertPALSDataToTempAccountPortalDBAdapter"
                 partnerLinkType="ns17:InsertPALSDataToTempAccountPortalDBAdapter_plt"
                 partnerRole="InsertPALSDataToTempAccountPortalDBAdapter_role"/>
    <partnerLink name="SelectValidDataTempAccountPortalDBAdapter"
                 partnerLinkType="ns18:SelectValidDataTempAccountPortalDBAdapter_plt"
                 partnerRole="SelectValidDataTempAccountPortalDBAdapter_role"/>
    <partnerLink name="SelectInValidDataTempAccountPortalDBAdapter"
                 partnerLinkType="ns19:SelectInValidDataTempAccountPortalDBAdapter_plt"
                 partnerRole="SelectInValidDataTempAccountPortalDBAdapter_role"/>
    <partnerLink name="TruncateTempAccountPortalDBAdapter"
                 partnerLinkType="ns20:TruncateTempAccountPortalDBAdapter_plt"
                 partnerRole="TruncateTempAccountPortalDBAdapter_role"/>
    <partnerLink name="SOAErrorHandlerJMSAdapter"
                 partnerLinkType="ns22:Produce_Message_plt"
                 partnerRole="Produce_Message_role"/>
    <partnerLink name="SOAErrorLogDBAdapter"
                 partnerLinkType="ns23:SOAErrorLogDBAdapter_plt"
                 partnerRole="SOAErrorLogDBAdapter_role"/>
    <partnerLink name="UpdateSOAErrorDBAdapter"
                 partnerLinkType="ns25:UpdateSOAErrorDBAdapter_plt"
                 partnerRole="UpdateSOAErrorDBAdapter_role"/>
  </partnerLinks>
  <variables>
    <variable name="AccountSummaryReqMsg"
              messageType="client:E004AccountPALStoPortalRequestMessage"/>
    <variable name="DeltaTS" type="xsd:string"/>
    <variable name="BatchSize" type="xsd:integer"/>
    <variable name="NumberOfBatches" type="xsd:integer"/>
    <variable name="Count" type="xsd:integer"/>
    <variable name="InvokeGetPALSDB2CountDBAdapter_GetPALSDB2CountDBAdapter_InputVariable"
              messageType="ns3:GetPALSDB2CountDBAdapterInput_msg"/>
    <variable name="InvokeGetPALSDB2CountDBAdapter_GetPALSDB2CountDBAdapter_OutputVariable"
              messageType="ns3:GetPALSDB2CountDBAdapterOutputCollection_msg"/>
    <variable name="InvokeSOADeltaTS_SelectDeltaTSDBAdapterSelect_InputVariable"
              messageType="ns1:SelectDeltaTSDBAdapterSelect_inputParameters"/>
    <variable name="InvokeSOADeltaTS_SelectDeltaTSDBAdapterSelect_OutputVariable"
              messageType="ns1:EngageSoaDeltatableCollection_msg"/>
    <variable name="DataCount" type="xsd:integer"/>
    <variable name="InvokeMergeDeltaTSSOADBAdapterV1_merge_InputVariable"
              messageType="ns7:EngageSoaDeltatableCollection_msg"/>
    <variable name="InvokePALSDB2DBAdapter_PALSDB2DBAdapterSelect_InputVariable"
              messageType="ns5:PALSDB2DBAdapterSelect_inputParameters"/>
    <variable name="InvokePALSDB2DBAdapter_PALSDB2DBAdapterSelect_OutputVariable"
              messageType="ns5:Cc071Vs1CssktoDtaCollection_msg"/>
    <variable name="ValidateAccountFields" element="ns10:Account"/>
    <variable name="ValidData" element="ns10:Account"/>
    <variable name="InvokeInsertInvalidDataSOAErrorDBAdapter_insert_InputVariable"
              messageType="ns11:EngagePalsAccDtaErrorlogCollection_msg"/>
    <variable name="InvokeMergeAccountPortalDBAdapter_insert_InputVariable"
              messageType="ns13:PrtAccountCollection_msg"/>
    <variable name="InvokeMergeAccountPortalDBAdapter_merge_InputVariable"
              messageType="ns13:PrtAccountCollection_msg"/>
    <variable name="InvokeSelectValidDataTempAccountPortal_SelectValidDataTempAccountPortalDBAdapter_InputVariable"
              messageType="ns18:SelectValidDataTempAccountPortalDBAdapterInput_msg"/>
    <variable name="InvokeSelectValidDataTempAccountPortal_SelectValidDataTempAccountPortalDBAdapter_OutputVariable"
              messageType="ns18:SelectValidDataTempAccountPortalDBAdapterOutputCollection_msg"/>
    <variable name="InvokeSelectInValidDataTempAccountPortal_SelectInValidDataTempAccountPortalDBAdapter_InputVariable"
              messageType="ns19:SelectInValidDataTempAccountPortalDBAdapterInput_msg"/>
    <variable name="InvokeSelectInValidDataTempAccountPortal_SelectInValidDataTempAccountPortalDBAdapter_OutputVariable"
              messageType="ns19:SelectInValidDataTempAccountPortalDBAdapterOutputCollection_msg"/>
    <variable name="InvokeTruncateTempAccountPortalDBAdapter_TruncateTempAccountPortalDBAdapter_InputVariable"
              messageType="ns20:TruncateTempAccountPortalDBAdapterInput_msg"/>
    <variable name="StandardErrorData" element="ns21:ErrorInfo"/>
    <variable name="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
              messageType="ns22:Produce_Message_msg"/>
    <variable name="ErrorFlag" type="xsd:string"/>
    <variable name="JNDI" type="xsd:string"/>
    <variable name="InvokeSOAErrorLogDBAdapter_SOAErrorLogDBAdapterSelect_InputVariable"
              messageType="ns23:SOAErrorLogDBAdapterSelect_inputParameters"/>
    <variable name="InvokeSOAErrorLogDBAdapter_SOAErrorLogDBAdapterSelect_OutputVariable"
              messageType="ns23:EngagePalsAccDtaErrorlogCollection_msg"/>
    <variable name="InvokeUpdateSOAErrorDBAdapter_update_InputVariable"
              messageType="ns25:EngagePalsAccDtaErrorlogCollection_msg"/>
    <variable name="InvokeInsertPALSDataToTempAccountPortal_insert_InputVariable"
              messageType="ns17:SoaAccountTempCollection_msg"/>
  </variables>
  <faultHandlers>
    <catch faultName="bpelx:remoteFault">
      <sequence name="Sequence2">

        <assign name="AssignStandardErrorData">
          <copy>
            <from expression="ora:getCompositeInstanceId()"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:InstanceID"/>
          </copy>
          <copy>
            <from expression="ora:getComponentName()"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:ComponentName"/>
          </copy>
          <copy>
            <from expression="'E004'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:ProjectID"/>
          </copy>
          <copy>
            <from expression="'E004AccountPALStoPortal'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:ProjectName"/>
          </copy>
          <copy>
            <from expression="xp20:current-dateTime()"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:Timestamp"/>
          </copy>
          <copy>
            <from expression="'PALS'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:Source"/>
          </copy>
          <copy>
            <from expression="'Portal'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:Target"/>
          </copy>
          <copy>
            <from expression="'SOAUSER'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:UserID"/>
          </copy>
          <copy>
            <from expression="'TE-002'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:ErrorDetails/ns21:ErrorCode"/>
          </copy>
          <copy>
            <from expression="ora:getFaultAsString()"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:ErrorDetails/ns21:ErrorDescription"/>
          </copy>
          <copy>
            <from expression="'Remote Fault'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:ErrorDetails/ns21:ErrorSummary"/>
          </copy>
          <copy>
            <from expression="'TE'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:ErrorNotification/ns21:LookupCriteria"/>
          </copy>
          <copy>
            <from expression="'DEV03:Remote Error in SOA Composite E004AccountPALStoPortal For interface E004'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:ErrorNotification/ns21:Subject"/>
          </copy>
        </assign>

        <invoke name="InvokeSOAErrorHandlerJMSAdapter"
                bpelx:invokeAsDetail="no"
                inputVariable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                partnerLink="SOAErrorHandlerJMSAdapter"
                portType="ns22:Produce_Message_ptt"
                operation="Produce_Message"/>
      </sequence>
    </catch>
    <catch faultName="bpelx:bindingFault">
      <sequence name="Sequence1">
        <assign name="AssignStandardErrorData">
          <copy>
            <from expression="ora:getCompositeInstanceId()"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:InstanceID"/>
          </copy>
          <copy>
            <from expression="ora:getComponentName()"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:ComponentName"/>
          </copy>
          <copy>
            <from expression="'E004'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:ProjectID"/>
          </copy>
          <copy>
            <from expression="'E004AccountPALStoPortal'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:ProjectName"/>
          </copy>
          <copy>
            <from expression="xp20:current-dateTime()"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:Timestamp"/>
          </copy>
          <copy>
            <from expression="'PALS'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:Source"/>
          </copy>
          <copy>
            <from expression="'Portal'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:Target"/>
          </copy>
          <copy>
            <from expression="'SOAUSER'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:UserID"/>
          </copy>
          <copy>
            <from expression="'TE-001'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:ErrorDetails/ns21:ErrorCode"/>
          </copy>
          <copy>
            <from expression="ora:getFaultAsString()"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:ErrorDetails/ns21:ErrorDescription"/>
          </copy>
          <copy>
            <from expression="'Binding Fault'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:ErrorDetails/ns21:ErrorSummary"/>
          </copy>
          <copy>
            <from expression="'TE'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:ErrorNotification/ns21:LookupCriteria"/>
          </copy>
          <copy>
            <from expression="'DEV03:Binding Error in SOA Composite E004AccountPALStoPortal For interface E004'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:ErrorNotification/ns21:Subject"/>
          </copy>
        </assign>
        <invoke name="InvokeSOAErrorHandlerJMSAdapter"
                bpelx:invokeAsDetail="no"
                inputVariable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                partnerLink="SOAErrorHandlerJMSAdapter"
                portType="ns22:Produce_Message_ptt"
                operation="Produce_Message"/>
      </sequence>
    </catch>
    <catchAll>
      <sequence name="Sequence3">

        <assign name="AssignStandardErrorData">
          <copy>
            <from expression="ora:getCompositeInstanceId()"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:InstanceID"/>
          </copy>
          <copy>
            <from expression="ora:getComponentName()"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:ComponentName"/>
          </copy>
          <copy>
            <from expression="'E004'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:ProjectID"/>
          </copy>
          <copy>
            <from expression="'E004AccountPALStoPortal'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:ProjectName"/>
          </copy>
          <copy>
            <from expression="xp20:current-dateTime()"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:Timestamp"/>
          </copy>
          <copy>
            <from expression="'PALS'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:Source"/>
          </copy>
          <copy>
            <from expression="'Portal'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:Target"/>
          </copy>
          <copy>
            <from expression="'SOAUSER'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:UserID"/>
          </copy>
          <copy>
            <from expression="'TE-003'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:ErrorDetails/ns21:ErrorCode"/>
          </copy>
          <copy>
            <from expression="'Other Technical Fault '"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:ErrorDetails/ns21:ErrorSummary"/>
          </copy>
          <copy>
            <from expression="ora:getFaultAsString()"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:ErrorDetails/ns21:ErrorDescription"/>
          </copy>
          <copy>
            <from expression="'TE'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:ErrorNotification/ns21:LookupCriteria"/>
          </copy>
          <copy>
            <from expression="'DEV03:Error Invoking SOA Composite E004AccountPALStoPortal for  interface E004'"/>
            <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                part="body"
                query="/ns21:ErrorInfo/ns21:ErrorNotification/ns21:Subject"/>
          </copy>
        </assign>
        <invoke name="InvokeSOAErrorHandlerJMSAdapter"
                bpelx:invokeAsDetail="no"
                inputVariable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                partnerLink="SOAErrorHandlerJMSAdapter"
                portType="ns22:Produce_Message_ptt"
                operation="Produce_Message"/>
      </sequence>
    </catchAll>
  </faultHandlers>
  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      VARIABLES                                                        
      List of messages and XML documents used within this BPEL process 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->

  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
     ORCHESTRATION LOGIC                                               
     Set of activities coordinating the flow of messages across the    
     services integrated within this business process                  
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <sequence name="main">

    <!-- Receive input from requestor. (Note: This maps to operation defined in E004AccountPALStoPortal.wsdl) -->
    <receive name="ReceiveAccountSummaryReqMsg" partnerLink="e004accountpalstoportal_client" portType="client:E004AccountPALStoPortal" operation="process"
             variable="AccountSummaryReqMsg" createInstance="yes"/>
    <assign name="AssignInitialValues">
      <copy>
        <from variable="AccountSummaryReqMsg" part="payload"
              query="/client:invocationMsg/client:BatchSize"/>
        <to variable="BatchSize"/>
      </copy>
      <copy>
        <from expression="'NO'"/>
        <to variable="ErrorFlag"/>
      </copy>
      <copy>
        <from variable="AccountSummaryReqMsg" part="payload"
              query="/client:invocationMsg/client:DatabaseJNDI"/>
        <to variable="JNDI"/>
      </copy>
      <copy>
        <from expression="0"/>
        <to variable="Count"/>
      </copy>
    </assign>
    <scope name="GetDeltaTSScope" variableAccessSerializable="no">
      <sequence name="GetDeltaTSSequence">
        <assign name="AssignSelectDeltaTSInputValues">
          <copy>
            <from variable="AccountSummaryReqMsg" part="payload"
                  query="/client:invocationMsg/client:InterfaceID"/>
            <to variable="InvokeSOADeltaTS_SelectDeltaTSDBAdapterSelect_InputVariable"
                part="SelectDeltaTSDBAdapterSelect_inputParameters"
                query="/ns2:SelectDeltaTSDBAdapterSelect_InterfaceID_CountryCodeInputParameters/ns2:InterfaceID"/>
          </copy>
          <copy>
            <from variable="AccountSummaryReqMsg" part="payload"
                  query="/client:invocationMsg/client:CountryCode"/>
            <to variable="InvokeSOADeltaTS_SelectDeltaTSDBAdapterSelect_InputVariable"
                part="SelectDeltaTSDBAdapterSelect_inputParameters"
                query="/ns2:SelectDeltaTSDBAdapterSelect_InterfaceID_CountryCodeInputParameters/ns2:CountryCode"/>
          </copy>
        </assign>
        <invoke name="InvokeSOADeltaTS"
                inputVariable="InvokeSOADeltaTS_SelectDeltaTSDBAdapterSelect_InputVariable"
                outputVariable="InvokeSOADeltaTS_SelectDeltaTSDBAdapterSelect_OutputVariable"
                partnerLink="SelectDeltaTSDBAdapter"
                portType="ns1:SelectDeltaTSDBAdapter_ptt"
                operation="SelectDeltaTSDBAdapterSelect"
                bpelx:invokeAsDetail="no"/>
        <switch name="Switch1">
          <case condition="count(bpws:getVariableData('InvokeSOADeltaTS_SelectDeltaTSDBAdapterSelect_OutputVariable','EngageSoaDeltatableCollection','/ns2:EngageSoaDeltatableCollection/ns2:EngageSoaDeltatable/ns2:palsDeltaTimestamp')) > 0">
            <bpelx:annotation>
              <bpelx:general>
                <bpelx:property name="userLabel">DeltaTS Exists</bpelx:property>
              </bpelx:general>
            </bpelx:annotation>
            <assign name="AssignDeltaTS">
              <copy>
                <from expression="substring-before(bpws:getVariableData('InvokeSOADeltaTS_SelectDeltaTSDBAdapterSelect_OutputVariable','EngageSoaDeltatableCollection','/ns2:EngageSoaDeltatableCollection/ns2:EngageSoaDeltatable/ns2:palsDeltaTimestamp'),'+')"/>
                <to variable="DeltaTS"/>
              </copy>
              <copy>
                <from expression="concat(substring-before(bpws:getVariableData('DeltaTS'),'T'),' ',substring-after(bpws:getVariableData('DeltaTS'),'T'))"/>
                <to variable="DeltaTS"/>
              </copy>
            </assign>
          </case>
          <otherwise>
            <assign name="AssignDefaultDeltaTS">
              <copy>
                <from expression="'0001-01-01 00:00:00.000000'"/>
                <to variable="DeltaTS"/>
              </copy>
            </assign>
          </otherwise>
        </switch>
      </sequence>
    </scope>
    <scope name="GetCountFromPALSScope" variableAccessSerializable="no">
      <sequence name="GetCountFromPALSSequence">
        <assign name="AssignDeltaTSValue">
          <copy>
            <from variable="DeltaTS"/>
            <to variable="InvokeGetPALSDB2CountDBAdapter_GetPALSDB2CountDBAdapter_InputVariable"
                part="GetPALSDB2CountDBAdapterInput_msg"
                query="/ns4:GetPALSDB2CountDBAdapterInput/ns4:DeltaTS"/>
          </copy>
        </assign>
        <invoke name="InvokeGetPALSDB2CountDBAdapter"
                bpelx:invokeAsDetail="no"
                inputVariable="InvokeGetPALSDB2CountDBAdapter_GetPALSDB2CountDBAdapter_InputVariable"
                outputVariable="InvokeGetPALSDB2CountDBAdapter_GetPALSDB2CountDBAdapter_OutputVariable"
                partnerLink="GetPALSDB2CountDBAdapter"
                portType="ns3:GetPALSDB2CountDBAdapter_ptt"
                operation="GetPALSDB2CountDBAdapter">
                <bpelx:inputProperty name="jca.jndi" variable="JNDI"/>
                </invoke>
        <assign name="CalculateBatchCount">
          <copy>
            <from expression="ceiling(bpws:getVariableData('InvokeGetPALSDB2CountDBAdapter_GetPALSDB2CountDBAdapter_OutputVariable','GetPALSDB2CountDBAdapterOutputCollection','/ns4:GetPALSDB2CountDBAdapterOutputCollection/ns4:GetPALSDB2CountDBAdapterOutput/ns4:count')  div  bpws:getVariableData('BatchSize'))"/>
            <to variable="NumberOfBatches"/>
          </copy>
        </assign>
      </sequence>
    </scope>
    <while name="WhileEachBatch"
           condition="bpws:getVariableData('Count') &lt; bpws:getVariableData('NumberOfBatches')">
      <sequence name="Sequence">
        <scope name="GetPALSdataScope" variableAccessSerializable="no">
          <sequence name="GetPALSdataSequence">
            <assign name="GetLatestDeltaTS">
              <copy>
                <from variable="AccountSummaryReqMsg" part="payload"
                      query="/client:invocationMsg/client:InterfaceID"/>
                <to variable="InvokeSOADeltaTS_SelectDeltaTSDBAdapterSelect_InputVariable"
                    part="SelectDeltaTSDBAdapterSelect_inputParameters"
                    query="/ns2:SelectDeltaTSDBAdapterSelect_InterfaceID_CountryCodeInputParameters/ns2:InterfaceID"/>
              </copy>
              <copy>
                <from variable="AccountSummaryReqMsg" part="payload"
                      query="/client:invocationMsg/client:CountryCode"/>
                <to variable="InvokeSOADeltaTS_SelectDeltaTSDBAdapterSelect_InputVariable"
                    part="SelectDeltaTSDBAdapterSelect_inputParameters"
                    query="/ns2:SelectDeltaTSDBAdapterSelect_InterfaceID_CountryCodeInputParameters/ns2:CountryCode"/>
              </copy>
            </assign>
            <invoke name="InvokeSOADeltaTS"
                    inputVariable="InvokeSOADeltaTS_SelectDeltaTSDBAdapterSelect_InputVariable"
                    outputVariable="InvokeSOADeltaTS_SelectDeltaTSDBAdapterSelect_OutputVariable"
                    partnerLink="SelectDeltaTSDBAdapter"
                    portType="ns1:SelectDeltaTSDBAdapter_ptt"
                    operation="SelectDeltaTSDBAdapterSelect"
                    bpelx:invokeAsDetail="no"/>
            <switch name="Switch2">
              <case condition="count(bpws:getVariableData('InvokeSOADeltaTS_SelectDeltaTSDBAdapterSelect_OutputVariable','EngageSoaDeltatableCollection','/ns2:EngageSoaDeltatableCollection/ns2:EngageSoaDeltatable/ns2:palsDeltaTimestamp')) > 0">
                <bpelx:annotation>
                  <bpelx:general>
                    <bpelx:property name="userLabel">DeltaTS Exists</bpelx:property>
                  </bpelx:general>
                </bpelx:annotation>
                <assign name="AssignDeltaTS">
                  <copy>
                    <from expression="substring-before(bpws:getVariableData('InvokeSOADeltaTS_SelectDeltaTSDBAdapterSelect_OutputVariable','EngageSoaDeltatableCollection','/ns2:EngageSoaDeltatableCollection/ns2:EngageSoaDeltatable/ns2:palsDeltaTimestamp'),'+')"/>
                    <to variable="DeltaTS"/>
                  </copy>
                  <copy>
                    <from expression="concat(substring-before(bpws:getVariableData('DeltaTS'),'T'),' ',substring-after(bpws:getVariableData('DeltaTS'),'T'))"/>
                    <to variable="DeltaTS"/>
                  </copy>
                </assign>
              </case>
              <otherwise>
                <assign name="AssignDefaultTS">
                  <copy>
                    <from expression="'0001-01-01 00:00:00.000000'"/>
                    <to variable="DeltaTS"/>
                  </copy>
                </assign>
              </otherwise>
            </switch>
            <assign name="AssignSelectPALSDB2DataInputValues">
              <copy>
                <from variable="DeltaTS"/>
                <to variable="InvokePALSDB2DBAdapter_PALSDB2DBAdapterSelect_InputVariable"
                    part="PALSDB2DBAdapterSelect_inputParameters"
                    query="/ns9:PALSDB2DBAdapterSelect_BatchSize_DeltaTimeStampInputParameters/ns9:DeltaTimeStamp"/>
              </copy>
              <copy>
                <from variable="BatchSize"/>
                <to variable="InvokePALSDB2DBAdapter_PALSDB2DBAdapterSelect_InputVariable"
                    part="PALSDB2DBAdapterSelect_inputParameters"
                    query="/ns9:PALSDB2DBAdapterSelect_BatchSize_DeltaTimeStampInputParameters/ns9:BatchSize"/>
              </copy>
            </assign>
            <invoke name="InvokePALSDB2DBAdapter"
                    inputVariable="InvokePALSDB2DBAdapter_PALSDB2DBAdapterSelect_InputVariable"
                    outputVariable="InvokePALSDB2DBAdapter_PALSDB2DBAdapterSelect_OutputVariable"
                    partnerLink="PALSDB2DBAdapter"
                    portType="ns5:PALSDB2DBAdapter_ptt"
                    operation="PALSDB2DBAdapterSelect" bpelx:invokeAsDetail="no">
                    <bpelx:inputProperty name="jca.jndi" variable="JNDI"/>
                    </invoke>
            <assign name="GetDataCount">
              <copy>
                <from expression="count(bpws:getVariableData('InvokePALSDB2DBAdapter_PALSDB2DBAdapterSelect_OutputVariable','Cc071Vs1CssktoDtaCollection','/ns9:Cc071Vs1CssktoDtaCollection/ns9:Cc071Vs1CssktoDta/ns9:deltaTs'))"/>
                <to variable="DataCount"/>
              </copy>
            </assign>
          </sequence>
        </scope>
        <scope name="ValidatePALSDataScope" variableAccessSerializable="no">
          <faultHandlers>
            <catch faultName="bpelx:invalidVariables">
              <sequence name="PALSDataErrorHandlingSequence">
                <assign name="XformPALSToInvalidData">
                  <bpelx:annotation>
                    <bpelx:pattern>transformation</bpelx:pattern>
                  </bpelx:annotation>
                  <copy>
                    <from expression="ora:doXSLTransformForDoc('xsl/XformPALSToInvalidData.xsl', $AccountSummaryReqMsg.payload, 'InvokePALSDB2DBAdapter_PALSDB2DBAdapterSelect_OutputVariable.Cc071Vs1CssktoDtaCollection', $InvokePALSDB2DBAdapter_PALSDB2DBAdapterSelect_OutputVariable.Cc071Vs1CssktoDtaCollection)"/>
                    <to variable="InvokeInsertInvalidDataSOAErrorDBAdapter_insert_InputVariable"
                        part="EngagePalsAccDtaErrorlogCollection"/>
                  </copy>
                </assign>
                <invoke name="InvokeMergeInvalidDataSOAErrorDBAdapter"
                        inputVariable="InvokeInsertInvalidDataSOAErrorDBAdapter_insert_InputVariable"
                        partnerLink="SOAErrorDBAdapter"
                        portType="ns11:SOAErrorDBAdapter_ptt"
                        operation="merge" bpelx:invokeAsDetail="no"/>
                <assign name="AssignErrorFlag">
                  <copy>
                    <from expression="'YES'"/>
                    <to variable="ErrorFlag"/>
                  </copy>
                </assign>
              </sequence>
            </catch>
          </faultHandlers>
          <sequence name="ValidatePALSDataSequence">
            <assign name="XformPALSToValidateAccountData">
              <bpelx:annotation>
                <bpelx:pattern>transformation</bpelx:pattern>
              </bpelx:annotation>
              <copy>
                <from expression="ora:doXSLTransformForDoc('xsl/XformPALSToVAlidateAccountData.xsl', $InvokePALSDB2DBAdapter_PALSDB2DBAdapterSelect_OutputVariable.Cc071Vs1CssktoDtaCollection, 'AccountSummaryReqMsg.payload', $AccountSummaryReqMsg.payload)"/>
                <to variable="ValidateAccountFields"/>
              </copy>
            </assign>
            <bpelx:validate name="ValidatePALSdata"
                            variables="ValidateAccountFields"/>
          </sequence>
        </scope>
        <scope name="InsertPALSDataInPortalDBScope"
               variableAccessSerializable="no">
          <faultHandlers>
            <catch faultName="bpelx:bindingFault">
              <switch name="Switch3">
                <case condition="contains(ora:getFaultAsString(),'integrity constraint')">
                  <bpelx:annotation>
                    <bpelx:general>
                      <bpelx:property name="userLabel">If Fault String equals 'integrity constraint'</bpelx:property>
                    </bpelx:general>
                  </bpelx:annotation>
                  <sequence name="BindingExceptionHandlingSequence">
                    <assign name="XformPALSValidDataToTempAccountPortal">
                      <bpelx:annotation>
                        <bpelx:pattern>transformation</bpelx:pattern>
                      </bpelx:annotation>
                      <copy>
                        <from expression="ora:doXSLTransformForDoc('xsl/XformPALSValidDataToTempAccountPortal.xsl', $AccountSummaryReqMsg.payload, 'InvokePALSDB2DBAdapter_PALSDB2DBAdapterSelect_OutputVariable.Cc071Vs1CssktoDtaCollection', $InvokePALSDB2DBAdapter_PALSDB2DBAdapterSelect_OutputVariable.Cc071Vs1CssktoDtaCollection)"/>
                        <to variable="InvokeInsertPALSDataToTempAccountPortal_insert_InputVariable"
                            part="SoaAccountTempCollection"/>
                      </copy>
                    </assign>
                    <invoke name="InvokeInsertPALSDataToTempAccountPortal"
                            inputVariable="InvokeInsertPALSDataToTempAccountPortal_insert_InputVariable"
                            partnerLink="InsertPALSDataToTempAccountPortalDBAdapter"
                            portType="ns17:InsertPALSDataToTempAccountPortalDBAdapter_ptt"
                            operation="insert" bpelx:invokeAsDetail="no"/>
                    <invoke name="InvokeSelectValidDataTempAccountPortal"
                            bpelx:invokeAsDetail="no"
                            inputVariable="InvokeSelectValidDataTempAccountPortal_SelectValidDataTempAccountPortalDBAdapter_InputVariable"
                            outputVariable="InvokeSelectValidDataTempAccountPortal_SelectValidDataTempAccountPortalDBAdapter_OutputVariable"
                            partnerLink="SelectValidDataTempAccountPortalDBAdapter"
                            portType="ns18:SelectValidDataTempAccountPortalDBAdapter_ptt"
                            operation="SelectValidDataTempAccountPortalDBAdapter"/>
                    <assign name="XformMergeTempValidDataToAccountPortal">
                      <bpelx:annotation>
                        <bpelx:pattern>transformation</bpelx:pattern>
                      </bpelx:annotation>
                      <copy>
                        <from expression="ora:doXSLTransformForDoc('xsl/XformMergeTempValidDataToAccountPortal.xsl', $InvokeSelectValidDataTempAccountPortal_SelectValidDataTempAccountPortalDBAdapter_OutputVariable.SelectValidDataTempAccountPortalDBAdapterOutputCollection)"/>
                        <to variable="InvokeMergeAccountPortalDBAdapter_merge_InputVariable"
                            part="PrtAccountCollection"/>
                      </copy>
                    </assign>
                    <invoke name="InvokeMergeTempValidDataToAccountPortalV1"
                            bpelx:invokeAsDetail="no"
                            inputVariable="InvokeMergeAccountPortalDBAdapter_merge_InputVariable"
                            partnerLink="MergeAccountPortalDBAdapter"
                            portType="ns13:MergeAccountPortalDBAdapter_ptt"
                            operation="merge"/>
                    <invoke name="InvokeSelectInValidDataTempAccountPortal"
                            bpelx:invokeAsDetail="no"
                            inputVariable="InvokeSelectInValidDataTempAccountPortal_SelectInValidDataTempAccountPortalDBAdapter_InputVariable"
                            outputVariable="InvokeSelectInValidDataTempAccountPortal_SelectInValidDataTempAccountPortalDBAdapter_OutputVariable"
                            partnerLink="SelectInValidDataTempAccountPortalDBAdapter"
                            portType="ns19:SelectInValidDataTempAccountPortalDBAdapter_ptt"
                            operation="SelectInValidDataTempAccountPortalDBAdapter"/>
                    <assign name="XformInvalidTempDataToSOAErrorDBAdapter">
                      <bpelx:annotation>
                        <bpelx:pattern>transformation</bpelx:pattern>
                      </bpelx:annotation>
                      <copy>
                        <from expression="ora:doXSLTransformForDoc('xsl/XformInvalidTempDataToSOAErrorDBAdapter.xsl', $InvokeSelectInValidDataTempAccountPortal_SelectInValidDataTempAccountPortalDBAdapter_OutputVariable.SelectInValidDataTempAccountPortalDBAdapterOutputCollection)"/>
                        <to variable="InvokeInsertInvalidDataSOAErrorDBAdapter_insert_InputVariable"
                            part="EngagePalsAccDtaErrorlogCollection"/>
                      </copy>
                    </assign>
                    <invoke name="InvokeMergeInvalidTempDataSOAErrorDBAdapter"
                            inputVariable="InvokeInsertInvalidDataSOAErrorDBAdapter_insert_InputVariable"
                            partnerLink="SOAErrorDBAdapter"
                            portType="ns11:SOAErrorDBAdapter_ptt"
                            operation="merge" bpelx:invokeAsDetail="no"/>
                    <invoke name="InvokeTruncateTempAccountPortalDBAdapter"
                            bpelx:invokeAsDetail="no"
                            inputVariable="InvokeTruncateTempAccountPortalDBAdapter_TruncateTempAccountPortalDBAdapter_InputVariable"
                            partnerLink="TruncateTempAccountPortalDBAdapter"
                            portType="ns20:TruncateTempAccountPortalDBAdapter_ptt"
                            operation="TruncateTempAccountPortalDBAdapter"/>
                    <assign name="AssignErrorFlag">
                      <copy>
                        <from expression="'yes'"/>
                        <to variable="ErrorFlag"/>
                      </copy>
                    </assign>
                  </sequence>
                </case>
                <otherwise>
                  <sequence name="ErrorLogNotificationSequence">
                    <assign name="AssignStandardErrorData">
                      <copy>
                        <from expression="ora:getCompositeInstanceId()"/>
                        <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                            part="body"
                            query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:InstanceID"/>
                      </copy>
                      <copy>
                        <from expression="ora:getComponentName()"/>
                        <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                            part="body"
                            query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:ComponentName"/>
                      </copy>
                      <copy>
                        <from expression="'E004'"/>
                        <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                            part="body"
                            query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:ProjectID"/>
                      </copy>
                      <copy>
                        <from expression="'E004AccountPALStoPortal'"/>
                        <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                            part="body"
                            query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:ProjectName"/>
                      </copy>
                      <copy>
                        <from expression="xp20:current-dateTime()"/>
                        <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                            part="body"
                            query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:Timestamp"/>
                      </copy>
                      <copy>
                        <from expression="'PALS'"/>
                        <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                            part="body"
                            query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:Source"/>
                      </copy>
                      <copy>
                        <from expression="'Portal'"/>
                        <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                            part="body"
                            query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:Target"/>
                      </copy>
                      <copy>
                        <from expression="'SOAUSER'"/>
                        <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                            part="body"
                            query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:UserID"/>
                      </copy>
                      <copy>
                        <from expression="'TE-001'"/>
                        <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                            part="body"
                            query="/ns21:ErrorInfo/ns21:ErrorDetails/ns21:ErrorCode"/>
                      </copy>
                      <copy>
                        <from expression="ora:getFaultAsString()"/>
                        <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                            part="body"
                            query="/ns21:ErrorInfo/ns21:ErrorDetails/ns21:ErrorDescription"/>
                      </copy>
                      <copy>
                        <from expression="'Binding Fault'"/>
                        <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                            part="body"
                            query="/ns21:ErrorInfo/ns21:ErrorDetails/ns21:ErrorSummary"/>
                      </copy>
                      <copy>
                        <from expression="'TE'"/>
                        <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                            part="body"
                            query="/ns21:ErrorInfo/ns21:ErrorNotification/ns21:LookupCriteria"/>
                      </copy>
                      <copy>
                        <from expression="'DEV03:Binding Error For interface E004'"/>
                        <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                            part="body"
                            query="/ns21:ErrorInfo/ns21:ErrorNotification/ns21:Subject"/>
                      </copy>
                    </assign>
                    <invoke name="InvokeSOAErrorHandlerJMSAdapter"
                            bpelx:invokeAsDetail="no"
                            inputVariable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                            partnerLink="SOAErrorHandlerJMSAdapter"
                            portType="ns22:Produce_Message_ptt"
                            operation="Produce_Message"/>
                  </sequence>
                </otherwise>
              </switch>
            </catch>
          </faultHandlers>
          <sequence name="InsertPALSDataInPortalDBSequence">
          <assign name="XformPALSValidDataToMergeAccountPortal">
              <bpelx:annotation>
                <bpelx:pattern>transformation</bpelx:pattern>
              </bpelx:annotation>
              <copy>
                <from expression="ora:doXSLTransformForDoc('xsl/XformPALSValidDataToMergeAccountPortal.xsl', $AccountSummaryReqMsg.payload, 'InvokePALSDB2DBAdapter_PALSDB2DBAdapterSelect_OutputVariable.Cc071Vs1CssktoDtaCollection', $InvokePALSDB2DBAdapter_PALSDB2DBAdapterSelect_OutputVariable.Cc071Vs1CssktoDtaCollection)"/>
                <to variable="InvokeMergeAccountPortalDBAdapter_merge_InputVariable"
                    part="PrtAccountCollection"/>
              </copy>
            </assign>
            <invoke name="InvokeMergeAccountPortalDBAdapter"
                    bpelx:invokeAsDetail="no"
                    inputVariable="InvokeMergeAccountPortalDBAdapter_merge_InputVariable"
                    partnerLink="MergeAccountPortalDBAdapter"
                    portType="ns13:MergeAccountPortalDBAdapter_ptt"
                    operation="merge"/>
          </sequence>
        </scope>
        <assign name="AssignInsertDeltaValues">
          <copy>
            <from variable="AccountSummaryReqMsg" part="payload"
                  query="/client:invocationMsg/client:InterfaceID"/>
            <to variable="InvokeMergeDeltaTSSOADBAdapterV1_merge_InputVariable"
                part="EngageSoaDeltatableCollection"
                query="/ns8:EngageSoaDeltatableCollection/ns8:EngageSoaDeltatable/ns8:interfaceid"/>
          </copy>
          <copy>
            <from variable="AccountSummaryReqMsg" part="payload"
                  query="/client:invocationMsg/client:CountryCode"/>
            <to variable="InvokeMergeDeltaTSSOADBAdapterV1_merge_InputVariable"
                part="EngageSoaDeltatableCollection"
                query="/ns8:EngageSoaDeltatableCollection/ns8:EngageSoaDeltatable/ns8:countrycode"/>
          </copy>
          <copy>
            <from variable="AccountSummaryReqMsg" part="payload"
                  query="/client:invocationMsg/client:UserName"/>
            <to variable="InvokeMergeDeltaTSSOADBAdapterV1_merge_InputVariable"
                part="EngageSoaDeltatableCollection"
                query="/ns8:EngageSoaDeltatableCollection/ns8:EngageSoaDeltatable/ns8:updatedby"/>
          </copy>
          <copy>
            <from expression="bpws:getVariableData('InvokePALSDB2DBAdapter_PALSDB2DBAdapterSelect_OutputVariable','Cc071Vs1CssktoDtaCollection','/ns9:Cc071Vs1CssktoDtaCollection/ns9:Cc071Vs1CssktoDta[$DataCount]/ns9:deltaTs')"/>
            <to variable="InvokeMergeDeltaTSSOADBAdapterV1_merge_InputVariable"
                part="EngageSoaDeltatableCollection"
                query="/ns8:EngageSoaDeltatableCollection/ns8:EngageSoaDeltatable/ns8:palsDeltaTimestamp"/>
          </copy>
          <copy>
            <from expression="xp20:current-dateTime()"/>
            <to variable="InvokeMergeDeltaTSSOADBAdapterV1_merge_InputVariable"
                part="EngageSoaDeltatableCollection"
                query="/ns8:EngageSoaDeltatableCollection/ns8:EngageSoaDeltatable/ns8:modifiedbytimestamp"/>
          </copy>
        </assign>
        <invoke name="InvokeMergeDeltaTSSOADBAdapterV1"
                bpelx:invokeAsDetail="no"
                inputVariable="InvokeMergeDeltaTSSOADBAdapterV1_merge_InputVariable"
                partnerLink="MergeDeltaTSSOADBAdapterV1"
                portType="ns7:MergeDeltaTSSOADBAdapterV1_ptt"
                operation="merge"/>
        <assign name="NextBatch">
          <copy>
            <from expression="bpws:getVariableData('Count') + 1"/>
            <to variable="Count"/>
          </copy>
        </assign>
      </sequence>
    </while>
    <switch name="RecordsExistsSwitch">
      <case condition="bpws:getVariableData('ErrorFlag') = 'YES'">
        <bpelx:annotation>
          <bpelx:general>
            <bpelx:property name="userLabel">If Error occured</bpelx:property>
          </bpelx:general>
        </bpelx:annotation>
        <sequence name="ErrorLogForwardingSequence">
          <invoke name="InvokeSOAErrorLogDBAdapter"
                  inputVariable="InvokeSOAErrorLogDBAdapter_SOAErrorLogDBAdapterSelect_InputVariable"
                  outputVariable="InvokeSOAErrorLogDBAdapter_SOAErrorLogDBAdapterSelect_OutputVariable"
                  partnerLink="SOAErrorLogDBAdapter"
                  portType="ns23:SOAErrorLogDBAdapter_ptt"
                  operation="SOAErrorLogDBAdapterSelect"
                  bpelx:invokeAsDetail="no"/>
          <assign name="XformSOAErrorLogToDummyVariable">
            <bpelx:annotation>
              <bpelx:pattern>transformation</bpelx:pattern>
            </bpelx:annotation>
            <copy>
              <from expression="ora:doXSLTransformForDoc('xsl/XformSOAErrorLogToDummyVariable.xsl', $InvokeSOAErrorLogDBAdapter_SOAErrorLogDBAdapterSelect_OutputVariable.EngagePalsAccDtaErrorlogCollection)"/>
              <to variable="ValidData"/>
            </copy>
          </assign>
          
                    <assign name="AssignStandardErrorData">
            <copy>
              <from expression="ora:getCompositeInstanceId()"/>
              <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                  part="body"
                  query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:InstanceID"/>
            </copy>
            <copy>
              <from expression="ora:getComponentName()"/>
              <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                  part="body"
                  query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:ComponentName"/>
            </copy>
            <copy>
              <from expression="'E004'"/>
              <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                  part="body"
                  query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:ProjectID"/>
            </copy>
            <copy>
              <from expression="'E004AccountPALStoPortal'"/>
              <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                  part="body"
                  query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:ProjectName"/>
            </copy>
            <copy>
              <from expression="xp20:current-dateTime()"/>
              <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                  part="body"
                  query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:Timestamp"/>
            </copy>
            <copy>
              <from expression="'PALS'"/>
              <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                  part="body"
                  query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:Source"/>
            </copy>
            <copy>
              <from expression="'Portal'"/>
              <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                  part="body"
                  query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:Target"/>
            </copy>
            <copy>
              <from expression="'SOAUSER'"/>
              <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                  part="body"
                  query="/ns21:ErrorInfo/ns21:CommonErrorData/ns21:UserID"/>
            </copy>
            <copy>
              <from expression="'BE-026'"/>
              <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                  part="body"
                  query="/ns21:ErrorInfo/ns21:ErrorDetails/ns21:ErrorCode"/>
            </copy>
            <copy>
              <from expression="ora:getNodeValue(bpws:getVariableData('ValidData','/ns10:Account'))"/>
              <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                  part="body"
                  query="/ns21:ErrorInfo/ns21:ErrorDetails/ns21:ErrorDescription"/>
            </copy>
            <copy>
              <from expression="'Unable to process record(s). Record(s) moved to errorlog'"/>
              <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                  part="body"
                  query="/ns21:ErrorInfo/ns21:ErrorDetails/ns21:ErrorSummary"/>
            </copy>
            <copy>
              <from expression="'BE'"/>
              <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                  part="body"
                  query="/ns21:ErrorInfo/ns21:ErrorNotification/ns21:LookupCriteria"/>
            </copy>
            <copy>
              <from expression="'DEV03: Error Processing Data in SOA composite E004AccountPALStoPortal For interface E004'"/>
              <to variable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                  part="body"
                  query="/ns21:ErrorInfo/ns21:ErrorNotification/ns21:Subject"/>
            </copy>
          </assign>

          <invoke name="InvokeSOAErrorHandlerJMSAdapter"
                  bpelx:invokeAsDetail="no"
                  inputVariable="InvokeSOAErrorHandlerJMSAdapter_Produce_Message_InputVariable"
                  partnerLink="SOAErrorHandlerJMSAdapter"
                  portType="ns22:Produce_Message_ptt"
                  operation="Produce_Message"/>
          <assign name="XformErrorFlagUpdateSOAErrorDBAdapter">
            <bpelx:annotation>
              <bpelx:pattern>transformation</bpelx:pattern>
            </bpelx:annotation>
            <copy>
              <from expression="ora:doXSLTransformForDoc('xsl/XformErrorFlagUpdateSOAErrorDBAdapter.xsl', $InvokeSOAErrorLogDBAdapter_SOAErrorLogDBAdapterSelect_OutputVariable.EngagePalsAccDtaErrorlogCollection)"/>
              <to variable="InvokeUpdateSOAErrorDBAdapter_update_InputVariable"
                  part="EngagePalsAccDtaErrorlogCollection"/>
            </copy>
          </assign>
          <invoke name="InvokeUpdateSOAErrorDBAdapter"
                  bpelx:invokeAsDetail="no"
                  inputVariable="InvokeUpdateSOAErrorDBAdapter_update_InputVariable"
                  partnerLink="UpdateSOAErrorDBAdapter"
                  portType="ns25:UpdateSOAErrorDBAdapter_ptt"
                  operation="update"/>
        </sequence>
      </case>
      <otherwise>
        <empty name="Empty"/>
      </otherwise>
    </switch>
  </sequence>
</process>