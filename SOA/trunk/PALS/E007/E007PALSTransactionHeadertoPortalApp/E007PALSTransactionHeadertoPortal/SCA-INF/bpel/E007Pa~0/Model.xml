<?xml version="1.0" encoding="UTF-8"?>
<process name="E007PalsTransactionHeadertoPortalBPEL" targetNamespace="http://xmlns.oracle.com/E007PALSTransactionHeadertoPortalApp/E007PALSTransactionHeadertoPortal/E007PalsTransactionHeadertoPortalBPEL" xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:client="http://xmlns.oracle.com/E007PALSTransactionHeadertoPortalApp/E007PALSTransactionHeadertoPortal/E007PalsTransactionHeadertoPortalBPEL" xmlns:ora="http://schemas.oracle.com/xpath/extension" xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:ns1="http://oracle.com/sca/soapservice/E007PALSTransactionHeadertoPortalApp/E007PALSTransactionHeadertoPortal/E007PalsTransactionHeadertoPortalService" xmlns:bpelx="http://schemas.oracle.com/bpel/extension" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ns2="http://www.statoilfuelretail.com/integration/E007/E007InvocationReqMsg" xmlns:bpel2="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20" xmlns:aia="http://www.oracle.com/XSL/Transform/java/oracle.apps.aia.core.xpath.AIAFunctions" xmlns:oraext="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc" xmlns:dvm="http://www.oracle.com/XSL/Transform/java/oracle.tip.dvm.LookupValue" xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath" xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath" xmlns:bpm="http://xmlns.oracle.com/bpmn20/extensions" xmlns:xdk="http://schemas.oracle.com/bpel/extension/xpath/function/xdk" xmlns:xref="http://www.oracle.com/XSL/Transform/java/oracle.tip.xref.xpath.XRefXPathFunctions" xmlns:ldap="http://schemas.oracle.com/xpath/extension/ldap" xmlns:ns3="http://xmlns.oracle.com/pcbpel/adapter/db/E007PALSTransactionHeadertoPortalApp/E007PALSTransactionHeadertoPortal/SelectDeltaTSSOADBAdapterV1" xmlns:ns4="http://xmlns.oracle.com/pcbpel/adapter/db/top/SelectDeltaTSSOADBAdapterV1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ns5="http://xmlns.oracle.com/pcbpel/adapter/db/E007PALSTransactionHeadertoPortalApp/E007PALSTransactionHeadertoPortal/GetPALSDB2RecordCountDBAdapterV1" xmlns:ns6="http://xmlns.oracle.com/pcbpel/adapter/db/GetPALSDB2RecordCountDBAdapterV1" xmlns:ns7="http://xmlns.oracle.com/pcbpel/adapter/db/E007PALSTransactionHeadertoPortalApp/E007PALSTransactionHeadertoPortal/SelectPALSTxnHeaderRecordsDBAdapterV1" xmlns:ns8="http://xmlns.oracle.com/pcbpel/adapter/db/top/SelectPALSTxnHeaderRecordsDBAdapterV1" xmlns:ns9="http://www.statoilfuelretail.com/integration/E007/TxnHeaderValidate" xmlns:ns10="http://xmlns.oracle.com/pcbpel/adapter/db/E007PALSTransactionHeadertoPortalApp/E007PALSTransactionHeadertoPortal/InsertTxnHeaderSOAErrorLogDBAdapterV1" xmlns:ns11="http://xmlns.oracle.com/pcbpel/adapter/db/E007PALSTransactionHeadertoPortalApp/E007PALSTransactionHeadertoPortal/MergeTxnHeaderPortalDBAdapterV1" xmlns:ns12="http://xmlns.oracle.com/pcbpel/adapter/db/E007PALSTransactionHeadertoPortalApp/E007PALSTransactionHeadertoPortal/UpdateTxnHeaderPortalDBAdapterV1" xmlns:ns13="http://xmlns.oracle.com/pcbpel/adapter/db/E007PALSTransactionHeadertoPortalApp/E007PALSTransactionHeadertoPortal/SelectErrorRecordsSOADBAdapterV1" xmlns:ns14="http://xmlns.oracle.com/pcbpel/adapter/jms/E007PALSTransactionHeadertoPortalApp/E007PALSTransactionHeadertoPortal/CommonErrorHandlerJMSAdapter" xmlns:ns15="http://xmlns.oracle.com/pcbpel/adapter/db/SelectErrorRecordsSOADBAdapterV1" xmlns:ns16="http://www.statoilfuelretail.com/integration/engage/ErrorHandling.xsd" xmlns:ns17="http://xmlns.oracle.com/pcbpel/adapter/db/top/InsertTxnHeaderSOAErrorLogDBAdapterV1" xmlns:ns18="http://xmlns.oracle.com/pcbpel/adapter/db/E007PALSTransactionHeadertoPortalApp/E007PALSTransactionHeadertoPortal/UpdateEmailErrorFlagSOADBAdapterV1" xmlns:ns19="http://xmlns.oracle.com/pcbpel/adapter/db/E007PALSTransactionHeadertoPortalApp/E007PALSTransactionHeadertoPortal/InsertDeltaTSSOADBAdapterV1" xmlns:ns20="http://xmlns.oracle.com/pcbpel/adapter/db/top/InsertDeltaTSSOADBAdapterV1" xmlns:ns21="http://xmlns.oracle.com/pcbpel/adapter/jms/E007PALSTransactionHeadertoPortalApp/E007PALSTransactionHeadertoPortal/SOAPALSNotificationJMSAdapter" xmlns:ns22="http://www.statoilfuelretail.com/integration/engage/PalsNotification" xmlns:ns23="http://xmlns.oracle.com/pcbpel/adapter/db/E007PALSTransactionHeadertoPortalApp/E007PALSTransactionHeadertoPortal/DeleteTxnHeaderPortalDBAdapterV1" id="BpPrc0">

  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
     ORCHESTRATION LOGIC                                               
     Set of activities coordinating the flow of messages across the    
     services integrated within this business process                  
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <partnerLinks>
    <partnerLink name="E007PalsTransactionHeadertoPortalService" partnerLinkType="ns1:E007PalsTransactionHeadertoPortalService" myRole="execute_ptt"/>
    <partnerLink name="SelectDeltaTSSOADBAdapterV1" partnerLinkType="ns3:SelectDeltaTSSOADBAdapterV1_plt" partnerRole="SelectDeltaTSSOADBAdapterV1_role"/>
    <partnerLink name="GetPALSDB2RecordCountDBAdapterV1" partnerLinkType="ns5:GetPALSDB2RecordCountDBAdapterV1_plt" partnerRole="GetPALSDB2RecordCountDBAdapterV1_role"/>
    <partnerLink name="SelectPALSTxnHeaderRecordsDBAdapterV1" partnerLinkType="ns7:SelectPALSTxnHeaderRecordsDBAdapterV1_plt" partnerRole="SelectPALSTxnHeaderRecordsDBAdapterV1_role"/>
    <partnerLink name="InsertTxnHeaderSOAErrorLogDBAdapterV1" partnerLinkType="ns10:InsertTxnHeaderSOAErrorLogDBAdapterV1_plt" partnerRole="InsertTxnHeaderSOAErrorLogDBAdapterV1_role"/>
    <partnerLink name="MergeTxnHeaderPortalDBAdapterV1" partnerLinkType="ns11:MergeTxnHeaderPortalDBAdapterV1_plt" partnerRole="MergeTxnHeaderPortalDBAdapterV1_role"/>
    <partnerLink name="UpdateTxnHeaderPortalDBAdapterV1" partnerLinkType="ns12:UpdateTxnHeaderPortalDBAdapterV1_plt" partnerRole="UpdateTxnHeaderPortalDBAdapterV1_role"/>
    <partnerLink name="SelectErrorRecordsSOADBAdapterV1" partnerLinkType="ns13:SelectErrorRecordsSOADBAdapterV1_plt" partnerRole="SelectErrorRecordsSOADBAdapterV1_role"/>
    <partnerLink name="CommonErrorHandlerJMSAdapter" partnerLinkType="ns14:Produce_Message_plt" partnerRole="Produce_Message_role"/>
    <partnerLink name="UpdateEmailErrorFlagSOADBAdapterV1" partnerLinkType="ns18:UpdateEmailErrorFlagSOADBAdapterV1_plt" partnerRole="UpdateEmailErrorFlagSOADBAdapterV1_role"/>
    <partnerLink name="InsertDeltaTSSOADBAdapterV1" partnerLinkType="ns19:InsertDeltaTSSOADBAdapterV1_plt" partnerRole="InsertDeltaTSSOADBAdapterV1_role"/>
    <partnerLink name="SOAPALSNotificationJMSAdapter" partnerLinkType="ns21:Produce_Message_plt" partnerRole="Produce_Message_role"/>
    <partnerLink name="DeleteTxnHeaderPortalDBAdapterV1" partnerLinkType="ns23:DeleteTxnHeaderPortalDBAdapterV1_plt" partnerRole="DeleteTxnHeaderPortalDBAdapterV1_role"/>
  </partnerLinks>
  <variables>
    <variable name="ReceiveTransactionHeaderReqMsg_IV" messageType="ns1:requestMessage"/>
    <variable name="batchSize" type="xsd:integer"/>
    <variable name="JNDI" type="xsd:string"/>
    <variable name="errorFlag" type="xsd:string"/>
    <variable name="InvokeSelectDeltaTSSOADBAdapterV1_IV" messageType="ns3:SelectDeltaTSSOADBAdapterV1Select_inputParameters"/>
    <variable name="InvokeSelectDeltaTSSOADBAdapterV1_OV" messageType="ns3:EngageSoaDeltatableCollection_msg"/>
    <variable name="deltaDB2FormatTS" type="xsd:string"/>
    <variable name="InvokeGetPALSDB2RecordCountDBAdapterV1_OV" messageType="ns5:GetPALSDB2RecordCountDBAdapterV1Output_msg"/>
    <variable name="batchCount" type="xsd:int"/>
    <variable name="batchCountIterator" type="xsd:int"/>
    <variable name="InvokeSelectPALSTxnRecordDBAdapterV1_IV" messageType="ns7:SelectPALSTxnHeaderRecordsDBAdapterV1Select_inputParameters"/>
    <variable name="InvokeSelectPALSTxnRecordDBAdapterV1_OV" messageType="ns7:Cc077Vs1CssordDtaCollection_msg"/>
    <variable name="dataCount" type="xsd:integer"/>
    <!--variable name="payloadValidate" element="ns9:TransactionHeader"/-->
    <variable name="InvokeInsertTxnHeaderSOAerrlogDBAdapterv1_IV" messageType="ns10:EngageSoaTxnheaderErrorlogCollection_msg"/>
    <variable name="InvokeMergeTxnHeaderDataPortalDBAdapterV1_IV" messageType="ns11:PrtCardTransactionHeaderCollection_msg"/>
    <variable name="InvokeUpdateTxnHeaderPortalDBAdapterV1_IV" messageType="ns12:PrtCardTransactionHeaderCollection_msg"/>
    <variable name="InvokeSelectErrorRecordsSOAAdapterV1_IV" messageType="ns13:SelectErrorRecordsSOADBAdapterV1Input_msg"/>
    <variable name="InvokeSelectErrorRecordsSOAAdapterV1_OV" messageType="ns13:SelectErrorRecordsSOADBAdapterV1OutputCollection_msg"/>
    <variable name="InvokeCommonErrorHandler_IV" messageType="ns14:Produce_Message_msg"/>
    <variable name="InvokeUpdateEmailErrorFlagSOADBAdapterV1_IV" messageType="ns18:EngageSoaTxnheaderErrorlogCollection_msg"/>
    <variable name="InvokeInsertDeltaTSSOADBAdapterV1_IV" messageType="ns19:EngageSoaDeltatableCollection_msg"/>
    <variable name="InvokeSOAPALSNotifationJMSAdapter_IV" messageType="ns21:Produce_Message_msg"/>
    <variable name="payloadValidate" element="ns9:TransactionHeader"/>
  </variables>
  <faultHandlers id="BpFhs0">
    <catch faultName="bpelx:remoteFault" id="BpCFt0"><sequence name="RemoteFaultSequence" id="BpSeq0"><assign name="AssignRemoteFault" xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/" id="BpAss0">
      
      
      
      
      
      
      
      
      
      
      
      
      
   <copy>
         <from expression="ora:getCompositeInstanceId()"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:InstanceID"/>
      </copy><copy>
         <from expression="ora:getCompositeName()"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:ComponentName"/>
      </copy><copy>
         <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:InterfaceID"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:ProjectID"/>
      </copy><copy>
         <from expression="'E007PALSTransactionHeadertoPortal'"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:ProjectName"/>
      </copy><copy>
         <from expression="xp20:current-dateTime()"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:Timestamp"/>
      </copy><copy>
         <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:SenderSystem"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:Source"/>
      </copy><copy>
         <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:ReceiverSystem"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:Target"/>
      </copy><copy>
         <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:UserName"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:UserID"/>
      </copy><copy>
         <from expression="'TE-002'"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorDetails/ns16:ErrorCode"/>
      </copy><copy>
         <from expression="'Remote Fault Occured in SOA for the interface E007'"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorDetails/ns16:ErrorSummary"/>
      </copy><copy>
            <from expression="ora:getFaultAsString()"/>
            <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorDetails/ns16:ErrorDescription"/>
          </copy><copy>
         <from expression="'E007_TE'"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorNotification/ns16:LookupCriteria"/>
      </copy><copy>
         <from expression="'Remote Fault occured in SOA  for the interface E007PALSTransactionHeadertoPortal'"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorNotification/ns16:Subject"/>
      </copy></assign><invoke name="InvokeCommonErrorHandler" inputVariable="InvokeCommonErrorHandler_IV" partnerLink="CommonErrorHandlerJMSAdapter" portType="ns14:Produce_Message_ptt" operation="Produce_Message" bpelx:invokeAsDetail="no" xmlns:bpelx="http://schemas.oracle.com/bpel/extension" xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/" id="BpInv0"/></sequence></catch>
    <catch faultName="bpelx:bindingFault" id="BpCFt1"><sequence name="BindingFaultSequence" id="BpSeq1"><assign name="AssignBindingFault" xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/" id="BpAss1">
      
      
      
      
      
      
      
      
      
      
      
      
      
   <copy>
         <from expression="ora:getCompositeInstanceId()"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:InstanceID"/>
      </copy><copy>
         <from expression="ora:getCompositeName()"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:ComponentName"/>
      </copy><copy>
         <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:InterfaceID"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:ProjectID"/>
      </copy><copy>
         <from expression="'E007PALSTransactionHeadertoPortal'"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:ProjectName"/>
      </copy><copy>
         <from expression="xp20:current-dateTime()"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:Timestamp"/>
      </copy><copy>
         <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:SenderSystem"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:Source"/>
      </copy><copy>
         <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:ReceiverSystem"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:Target"/>
      </copy><copy>
         <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:UserName"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:UserID"/>
      </copy><copy>
         <from expression="'TE-001'"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorDetails/ns16:ErrorCode"/>
      </copy><copy>
         <from expression="'Binding Fault Occured in SOA for the interface E007'"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorDetails/ns16:ErrorSummary"/>
      </copy><copy>
            <from expression="ora:getFaultAsString()"/>
            <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorDetails/ns16:ErrorDescription"/>
          </copy><copy>
         <from expression="'E007_TE'"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorNotification/ns16:LookupCriteria"/>
      </copy><copy>
         <from expression="'Binding Fault occured in SOA  for the interface E007PALSTransactionHeadertoPortal'"/>
         <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorNotification/ns16:Subject"/>
      </copy></assign><invoke name="InvokeCommonErrorHandler" inputVariable="InvokeCommonErrorHandler_IV" partnerLink="CommonErrorHandlerJMSAdapter" portType="ns14:Produce_Message_ptt" operation="Produce_Message" bpelx:invokeAsDetail="no" xmlns:bpelx="http://schemas.oracle.com/bpel/extension" xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/" id="BpInv1"/></sequence></catch>
    <catchAll id="BpCAl0"><sequence name="CatchAllSequence" id="BpSeq2"><assign name="AssignFault" xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/" id="BpAss2">
          <copy>
            <from expression="ora:getCompositeInstanceId()"/>
            <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:InstanceID"/>
          </copy>
          <copy>
            <from expression="ora:getCompositeName()"/>
            <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:ComponentName"/>
          </copy>
          <copy>
            <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:InterfaceID"/>
            <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:ProjectID"/>
          </copy>
          <copy>
            <from expression="'E007PALSTransactionHeadertoPortal'"/>
            <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:ProjectName"/>
          </copy>
          <copy>
            <from expression="xp20:current-dateTime()"/>
            <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:Timestamp"/>
          </copy>
          <copy>
            <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:SenderSystem"/>
            <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:Source"/>
          </copy>
          <copy>
            <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:ReceiverSystem"/>
            <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:Target"/>
          </copy>
          <copy>
            <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:UserName"/>
            <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:UserID"/>
          </copy>
          <copy>
            <from expression="'TE-003'"/>
            <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorDetails/ns16:ErrorCode"/>
          </copy>
          <copy>
            <from expression="'Technical Fault Occured in SOA for the interface E007'"/>
            <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorDetails/ns16:ErrorSummary"/>
          </copy>
          <copy>
            <from expression="ora:getFaultAsString()"/>
            <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorDetails/ns16:ErrorDescription"/>
          </copy>
          <copy>
            <from expression="'E007_TE'"/>
            <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorNotification/ns16:LookupCriteria"/>
          </copy>
          <copy>
            <from expression="'Technical Fault occured in SOA  for the interface E007PALSTransactionHeadertoPortal'"/>
            <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorNotification/ns16:Subject"/>
          </copy>
        </assign><invoke name="InvokeCommonErrorHandler" inputVariable="InvokeCommonErrorHandler_IV" partnerLink="CommonErrorHandlerJMSAdapter" portType="ns14:Produce_Message_ptt" operation="Produce_Message" bpelx:invokeAsDetail="no" xmlns:bpelx="http://schemas.oracle.com/bpel/extension" xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/" id="BpInv2"/></sequence></catchAll>
  </faultHandlers>
  <sequence name="main" id="BpSeq3">
    <receive name="ReceiveTransactionHeaderReqMsg" createInstance="yes" variable="ReceiveTransactionHeaderReqMsg_IV" partnerLink="E007PalsTransactionHeadertoPortalService" portType="ns1:execute_ptt" operation="execute" id="BpRcv0"/>
    <assign name="AssignInitialValues" id="BpAss3">
      <copy>
        <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:BatchSize"/>
        <to variable="batchSize"/>
      </copy>
      <copy>
        <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:PALS_JNDI"/>
        <to variable="JNDI"/>
      </copy>
      <copy>
        <from expression="'false'"/>
        <to variable="errorFlag"/>
      </copy>
    </assign>
    <scope name="GetDeltaTSScope" variableAccessSerializable="no" id="BpScp0">
      <!--variables>
        <variable name="InvokeSelectDeltaTSSOADBAdapterV1_IV"
                  messageType="ns3:SelectDeltaTSSOADBAdapterV1Select_inputParameters"/>
      </variables-->
      <sequence name="GetDeltaTSScopeSequence" id="BpSeq4">
        <assign name="AssignInterfaceIDCountryCode" id="BpAss4">
          <copy>
            <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:InterfaceID"/>
            <to variable="InvokeSelectDeltaTSSOADBAdapterV1_IV" part="SelectDeltaTSSOADBAdapterV1Select_inputParameters" query="/ns4:SelectDeltaTSSOADBAdapterV1Select_Interface_ID_Country_CodeInputParameters/ns4:Interface_ID"/>
          </copy>
          <copy>
            <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:CountryCode"/>
            <to variable="InvokeSelectDeltaTSSOADBAdapterV1_IV" part="SelectDeltaTSSOADBAdapterV1Select_inputParameters" query="/ns4:SelectDeltaTSSOADBAdapterV1Select_Interface_ID_Country_CodeInputParameters/ns4:Country_Code"/>
          </copy>
        </assign>
        <invoke name="InvokeSelectDeltaTSSOADBAdapterV1" inputVariable="InvokeSelectDeltaTSSOADBAdapterV1_IV" outputVariable="InvokeSelectDeltaTSSOADBAdapterV1_OV" partnerLink="SelectDeltaTSSOADBAdapterV1" portType="ns3:SelectDeltaTSSOADBAdapterV1_ptt" operation="SelectDeltaTSSOADBAdapterV1Select" bpelx:invokeAsDetail="no" id="BpInv3"/>
        <switch name="Switch1" id="BpSwt0">
          <case condition="count(bpws:getVariableData('InvokeSelectDeltaTSSOADBAdapterV1_OV','EngageSoaDeltatableCollection','/ns4:EngageSoaDeltatableCollection/ns4:EngageSoaDeltatable')) > 0">
            <bpelx:annotation>
              <bpelx:general>
                <bpelx:property name="userLabel">Delta TS Exists</bpelx:property>
              </bpelx:general>
            </bpelx:annotation>
            <sequence name="FormarDeltaTSSequence" id="BpSeq5">
              <assign name="AssignDeltaTS" id="BpAss5">
                <copy>
                  <from expression="substring-before(bpws:getVariableData('InvokeSelectDeltaTSSOADBAdapterV1_OV','EngageSoaDeltatableCollection','/ns4:EngageSoaDeltatableCollection/ns4:EngageSoaDeltatable/ns4:palsDeltaTimestamp'), '+')"/>
                  <to variable="deltaDB2FormatTS"/>
                </copy>
              </assign>
              <assign name="FormatDeltaTS" id="BpAss6">
                <copy>
                  <from expression="concat(substring-before(bpws:getVariableData('deltaDB2FormatTS'),'T'), ' ',substring-after(bpws:getVariableData('deltaDB2FormatTS'),'T'))"/>
                  <to variable="deltaDB2FormatTS"/>
                </copy>
              </assign>
            </sequence>
          </case>
          <otherwise>
            <assign name="AssignDefaultDeltaTS" id="BpAss7">
              <copy>
                <from expression="'0001-01-01 00:00:00.000000'"/>
                <to variable="deltaDB2FormatTS"/>
              </copy>
            </assign>
          </otherwise>
        </switch>
      </sequence>
    </scope>
    <scope name="GetRecordCountfromPALSScope" variableAccessSerializable="no" id="BpScp1">
      <variables>
        <variable name="InvokeGetPALSDB2RecordCountDBAdapterV1_IV" messageType="ns5:GetPALSDB2RecordCountDBAdapterV1Input_msg"/>
      </variables>
      <sequence name="GetRecordCountfromPALSSequence" id="BpSeq6">
        <assign name="AssignDeltaTS" id="BpAss8">
          <copy>
            <from variable="deltaDB2FormatTS"/>
            <to variable="InvokeGetPALSDB2RecordCountDBAdapterV1_IV" part="GetPALSDB2RecordCountDBAdapterV1Input_msg" query="/ns6:GetPALSDB2RecordCountDBAdapterV1Input/ns6:DeltaTimeStamp"/>
          </copy>
        </assign>
        <invoke name="InvokeGetPALSDB2RecordCountDBAdapterV1" inputVariable="InvokeGetPALSDB2RecordCountDBAdapterV1_IV" outputVariable="InvokeGetPALSDB2RecordCountDBAdapterV1_OV" partnerLink="GetPALSDB2RecordCountDBAdapterV1" portType="ns5:GetPALSDB2RecordCountDBAdapterV1_ptt" operation="GetPALSDB2RecordCountDBAdapterV1" bpelx:invokeAsDetail="no" id="BpInv4">
                <bpelx:inputProperty name="jca.jndi" variable="JNDI"/>
        </invoke>
        <switch name="Switch4" id="BpSwt1">
          <case condition="((bpws:getVariableData('ReceiveTransactionHeaderReqMsg_IV','part1','/ns2:invocationMsg/ns2:BatchCount')!='') and (number(bpws:getVariableData('ReceiveTransactionHeaderReqMsg_IV','part1','/ns2:invocationMsg/ns2:BatchCount'))&lt;( ceiling(number(bpws:getVariableData('InvokeGetPALSDB2RecordCountDBAdapterV1_OV','GetPALSDB2RecordCountDBAdapterV1Output','/ns6:GetPALSDB2RecordCountDBAdapterV1Output/ns6:count'))  div number(bpws:getVariableData('batchSize'))))))">
            <bpelx:annotation>
              <bpelx:general>
                <bpelx:property name="userLabel">Batch count given</bpelx:property>
              </bpelx:general>
            </bpelx:annotation>
            <assign name="AssignBatchCount" id="BpAss9">
              <copy>
                <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:BatchCount"/>
                <to variable="batchCount"/>
              </copy>
              <copy>
                <from expression="1"/>
                <to variable="batchCountIterator"/>
              </copy>
            </assign>
          </case>
          <otherwise>
            <assign name="CalcuteBatchCount" id="BpAss10">
              <copy>
                <from expression="ceiling(number(bpws:getVariableData('InvokeGetPALSDB2RecordCountDBAdapterV1_OV','GetPALSDB2RecordCountDBAdapterV1Output','/ns6:GetPALSDB2RecordCountDBAdapterV1Output/ns6:count'))  div number(bpws:getVariableData('batchSize')))"/>
                <to variable="batchCount"/>
              </copy>
              <copy>
                <from expression="1"/>
                <to variable="batchCountIterator"/>
              </copy>
            </assign>
          </otherwise>
        </switch>
      </sequence>
    </scope>
    <while name="WhileEachBatch" condition="bpws:getVariableData('batchCountIterator') &lt;= bpws:getVariableData('batchCount')" id="BpWhl0">
      <sequence name="BatchExecutionSequence" id="BpSeq7">
        <scope name="GetTransactionHeaderDataScope" variableAccessSerializable="no" id="BpScp2">
          <sequence name="GetTransactionHeaderDataSequence" id="BpSeq8">
            <assign name="GetLatestDeltaTS" id="BpAss11">
              <copy>
                <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:InterfaceID"/>
                <to variable="InvokeSelectDeltaTSSOADBAdapterV1_IV" part="SelectDeltaTSSOADBAdapterV1Select_inputParameters" query="/ns4:SelectDeltaTSSOADBAdapterV1Select_Interface_ID_Country_CodeInputParameters/ns4:Interface_ID"/>
              </copy>
              <copy>
                <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:CountryCode"/>
                <to variable="InvokeSelectDeltaTSSOADBAdapterV1_IV" part="SelectDeltaTSSOADBAdapterV1Select_inputParameters" query="/ns4:SelectDeltaTSSOADBAdapterV1Select_Interface_ID_Country_CodeInputParameters/ns4:Country_Code"/>
              </copy>
            </assign>
            <invoke name="InvokeSelectDeltaTSSOADBAdapterV1" inputVariable="InvokeSelectDeltaTSSOADBAdapterV1_IV" outputVariable="InvokeSelectDeltaTSSOADBAdapterV1_OV" partnerLink="SelectDeltaTSSOADBAdapterV1" portType="ns3:SelectDeltaTSSOADBAdapterV1_ptt" operation="SelectDeltaTSSOADBAdapterV1Select" bpelx:invokeAsDetail="no" id="BpInv5"/>
            <switch name="Switch2" id="BpSwt2">
              <case condition="count(bpws:getVariableData('InvokeSelectDeltaTSSOADBAdapterV1_OV','EngageSoaDeltatableCollection','/ns4:EngageSoaDeltatableCollection/ns4:EngageSoaDeltatable')) > 0">
                <bpelx:annotation>
                  <bpelx:general>
                    <bpelx:property name="userLabel">Is Delta TS Exists</bpelx:property>
                  </bpelx:general>
                </bpelx:annotation>
                <sequence name="GetDeltaTSSequence" id="BpSeq9">
                  <assign name="AssignDeltaTS" id="BpAss12">
                    <copy>
                      <from expression="substring-before(bpws:getVariableData('InvokeSelectDeltaTSSOADBAdapterV1_OV','EngageSoaDeltatableCollection','/ns4:EngageSoaDeltatableCollection/ns4:EngageSoaDeltatable/ns4:palsDeltaTimestamp'),'+')"/>
                      <to variable="deltaDB2FormatTS"/>
                    </copy>
                  </assign>
                  <assign name="FormatDeltaTS" id="BpAss13">
                    <copy>
                      <from expression="concat(substring-before(bpws:getVariableData('deltaDB2FormatTS'),'T'), ' ', substring-after(bpws:getVariableData('deltaDB2FormatTS'),'T'))"/>
                      <to variable="deltaDB2FormatTS"/>
                    </copy>
                  </assign>
                </sequence>
              </case>
              <otherwise>
                <assign name="AssignDefaultTS" id="BpAss14">
                  <copy>
                    <from expression="'0001-01-01 00:00:00.000000'"/>
                    <to variable="deltaDB2FormatTS"/>
                  </copy>
                </assign>
              </otherwise>
            </switch>
            <assign name="AssignSelectPalsTxnHearderRecordsInputParameters" id="BpAss15">
              <copy>
                <from variable="deltaDB2FormatTS"/>
                <to variable="InvokeSelectPALSTxnRecordDBAdapterV1_IV" part="SelectPALSTxnHeaderRecordsDBAdapterV1Select_inputParameters" query="/ns8:SelectPALSTxnHeaderRecordsDBAdapterV1Select_DeltaTimeStamp_BatchSizeInputParameters/ns8:DeltaTimeStamp"/>
              </copy>
              <copy>
                <from variable="batchSize"/>
                <to variable="InvokeSelectPALSTxnRecordDBAdapterV1_IV" part="SelectPALSTxnHeaderRecordsDBAdapterV1Select_inputParameters" query="/ns8:SelectPALSTxnHeaderRecordsDBAdapterV1Select_DeltaTimeStamp_BatchSizeInputParameters/ns8:BatchSize"/>
              </copy>
            </assign>
            <invoke name="InvokeSelectPALSTxnHeaderRecordDBAdapterV1" inputVariable="InvokeSelectPALSTxnRecordDBAdapterV1_IV" outputVariable="InvokeSelectPALSTxnRecordDBAdapterV1_OV" partnerLink="SelectPALSTxnHeaderRecordsDBAdapterV1" portType="ns7:SelectPALSTxnHeaderRecordsDBAdapterV1_ptt" operation="SelectPALSTxnHeaderRecordsDBAdapterV1Select" bpelx:invokeAsDetail="no" id="BpInv6">
                    <bpelx:inputProperty name="jca.jndi" variable="JNDI"/>
           </invoke>
            <assign name="AssignDataCount" id="BpAss16">
              <copy>
                <from expression="count(bpws:getVariableData('InvokeSelectPALSTxnRecordDBAdapterV1_OV','Cc077Vs1CssordDtaCollection','/ns8:Cc077Vs1CssordDtaCollection/ns8:Cc077Vs1CssordDta'))"/>
                <to variable="dataCount"/>
              </copy>
            </assign>
            <scope name="DataValidationScope" variableAccessSerializable="no" id="BpScp3">
              <faultHandlers id="BpFhs1">
                <catch faultName="bpelx:invalidVariables" id="BpCFt2">
                  <sequence name="DataValidationSequence" id="BpSeq10">
                    <assign name="Xform_ValidationPayload_to_SOATxnHeaderErrorLog" id="BpAss17">
                      <bpelx:annotation>
                        <bpelx:pattern>transformation</bpelx:pattern>
                      </bpelx:annotation>
                      <copy>
                        <from expression="ora:doXSLTransformForDoc('xsl/ValidationPayload_to_SOATxnHeaderErrorLog.xsl', $payloadValidate)"/>
                        <to variable="InvokeInsertTxnHeaderSOAerrlogDBAdapterv1_IV" part="EngageSoaTxnheaderErrorlogCollection"/>
                      </copy>
                    </assign>
                    <invoke name="InvokeInsertTxnHeaderSOAerrlogDBAdapterv1" inputVariable="InvokeInsertTxnHeaderSOAerrlogDBAdapterv1_IV" partnerLink="InsertTxnHeaderSOAErrorLogDBAdapterV1" portType="ns10:InsertTxnHeaderSOAErrorLogDBAdapterV1_ptt" operation="merge" bpelx:invokeAsDetail="no" id="BpInv7"/>
                    <assign name="EnableErrorFlag" id="BpAss18">
                      <copy>
                        <from expression="'true'"/>
                        <to variable="errorFlag"/>
                      </copy>
                    </assign>
                  </sequence>
                </catch>
              </faultHandlers>
              <sequence name="DataValidationSequence" id="BpSeq11">
                <assign name="Xform_PalsTxnHeaderData_to_PayloadValidation" id="BpAss19">
                  <bpelx:annotation>
                    <bpelx:pattern>transformation</bpelx:pattern>
                  </bpelx:annotation>
                  <copy>
                    <from expression="ora:doXSLTransformForDoc('xsl/PalsTxnHeaderData_to_PayloadValidation.xsl', $ReceiveTransactionHeaderReqMsg_IV.part1, 'InvokeSelectPALSTxnRecordDBAdapterV1_OV.Cc077Vs1CssordDtaCollection', $InvokeSelectPALSTxnRecordDBAdapterV1_OV.Cc077Vs1CssordDtaCollection)"/>
                    <to variable="payloadValidate"/>
                  </copy>
                </assign>
                <bpelx:validate name="Validate" variables="payloadValidate" id="BpVal0"/>
              </sequence>
            </scope>
            <scope name="InsertTxnHeaderDatatoPortalScope" variableAccessSerializable="no" id="BpScp4">
              <variables>
                <variable name="InvokeDeleteTxnHeaderPortalDBAdapterV1_IV" messageType="ns23:PrtCardTransactionHeaderCollection_msg"/>
              </variables>
              <sequence name="InsertTxnHeaderDatatoPortalSequence" id="BpSeq12">
                <!--assign name="Xform_TxnHeaderPals_to_Portal">
                  <bpelx:annotation>
                    <bpelx:pattern>transformation</bpelx:pattern>
                  </bpelx:annotation>
                  <copy>
                    <from expression="ora:doXSLTransformForDoc('xsl/TxnHeaderPals_to_Portal.xsl', $ReceiveTransactionHeaderReqMsg_IV.part1, 'InvokeSelectPALSTxnRecordDBAdapterV1_OV.Cc077Vs1CssordDtaCollection', $InvokeSelectPALSTxnRecordDBAdapterV1_OV.Cc077Vs1CssordDtaCollection)"/>
                    <to variable="InvokeMergeTxnHeaderDataPortalDBAdapterV1_IV"
                        part="PrtCardTransactionHeaderCollection"/>
                  </copy>
                </assign-->
                <assign name="Xform_TxnHeaderPals_to_Portal" id="BpAss20">
                  <bpelx:annotation>
                    <bpelx:pattern>transformation</bpelx:pattern>
                  </bpelx:annotation>
                  <copy>
                    <from expression="ora:doXSLTransformForDoc('xsl/TxnHeaderPals_to_Portal.xsl', $ReceiveTransactionHeaderReqMsg_IV.part1, 'InvokeSelectPALSTxnRecordDBAdapterV1_OV.Cc077Vs1CssordDtaCollection', $InvokeSelectPALSTxnRecordDBAdapterV1_OV.Cc077Vs1CssordDtaCollection)"/>
                    <to variable="InvokeMergeTxnHeaderDataPortalDBAdapterV1_IV" part="PrtCardTransactionHeaderCollection"/>
                  </copy>
                </assign>
                <invoke name="InvokeMergeTxnHeaderDataPortalDBAdapterV1" inputVariable="InvokeMergeTxnHeaderDataPortalDBAdapterV1_IV" partnerLink="MergeTxnHeaderPortalDBAdapterV1" portType="ns11:MergeTxnHeaderPortalDBAdapterV1_ptt" operation="merge" bpelx:invokeAsDetail="no" id="BpInv8"/>
                <flow name="Flow1" id="BpFlw0">
                  <sequence name="Sequence" id="BpSeq13">
                    <assign name="Xform_PortalTxnHeader_PortalTxnHeaderLastOdometer" id="BpAss21">
                      <bpelx:annotation>
                        <bpelx:pattern>transformation</bpelx:pattern>
                      </bpelx:annotation>
                      <copy>
                        <from expression="ora:doXSLTransformForDoc('xsl/PortalTxnHeader_PortalTxnHeaderOdometer.xsl', $ReceiveTransactionHeaderReqMsg_IV.part1, 'InvokeSelectPALSTxnRecordDBAdapterV1_OV.Cc077Vs1CssordDtaCollection', $InvokeSelectPALSTxnRecordDBAdapterV1_OV.Cc077Vs1CssordDtaCollection)"/>
                        <to variable="InvokeUpdateTxnHeaderPortalDBAdapterV1_IV" part="PrtCardTransactionHeaderCollection"/>
                      </copy>
                    </assign>
                  </sequence>
                  <sequence name="Sequence6" id="BpSeq14">
                    <switch name="Switch9" id="BpSwt3">
                      <case condition="bpws:getVariableData('InvokeSelectPALSTxnRecordDBAdapterV1_OV','Cc077Vs1CssordDtaCollection','/ns8:Cc077Vs1CssordDtaCollection/ns8:Cc077Vs1CssordDta/ns8:slgtransstatusKd')='PRE' and bpws:getVariableData('InvokeSelectPALSTxnRecordDBAdapterV1_OV','Cc077Vs1CssordDtaCollection','/ns8:Cc077Vs1CssordDtaCollection/ns8:Cc077Vs1CssordDta/ns8:prelimstatusKd')='EXP'">
                        <sequence id="BpSeq15">
                          <assign name="Xform_PortalTxnHeader_PortalTxnHeaderLastOdometer" xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/" id="BpAss22">
                            <bpelx:annotation xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                              <bpelx:pattern>transformation</bpelx:pattern>
                            </bpelx:annotation>
                            <copy>
                              <from expression="ora:doXSLTransformForDoc('xsl/PortalTxnHeader_DeletePortalTxnHeader.xsl', $ReceiveTransactionHeaderReqMsg_IV.part1, 'InvokeSelectPALSTxnRecordDBAdapterV1_OV.Cc077Vs1CssordDtaCollection', $InvokeSelectPALSTxnRecordDBAdapterV1_OV.Cc077Vs1CssordDtaCollection)"/>
                              <to variable="InvokeDeleteTxnHeaderPortalDBAdapterV1_IV" part="PrtCardTransactionHeaderCollection"/>
                            </copy>
                          </assign>
                          <invoke name="InvokeDeleteTxnHeaderPortalDBAdapterV1" inputVariable="InvokeDeleteTxnHeaderPortalDBAdapterV1_IV" partnerLink="DeleteTxnHeaderPortalDBAdapterV1" portType="ns23:DeleteTxnHeaderPortalDBAdapterV1_ptt" operation="delete" bpelx:invokeAsDetail="no" id="BpInv9"/>
                        </sequence>
                      </case>
                      <otherwise>
                        <empty name="NothingToDelete" id="BpEmp0"/>
                      </otherwise>
                    </switch>
                  </sequence>
                </flow>
                <invoke name="InvokeUpdateTxnHeaderPortalDBAdapterV1" inputVariable="InvokeUpdateTxnHeaderPortalDBAdapterV1_IV" partnerLink="UpdateTxnHeaderPortalDBAdapterV1" portType="ns12:UpdateTxnHeaderPortalDBAdapterV1_ptt" operation="update" bpelx:invokeAsDetail="no" id="BpInv10"/>
              </sequence>
            </scope>
          </sequence>
        </scope>
        <assign name="AssignLatestDeltaTSSOADBAdapterV1" id="BpAss23">
          <copy>
            <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:InterfaceID"/>
            <to variable="InvokeInsertDeltaTSSOADBAdapterV1_IV" part="EngageSoaDeltatableCollection" query="/ns20:EngageSoaDeltatableCollection/ns20:EngageSoaDeltatable/ns20:interfaceid"/>
          </copy>
          <copy>
            <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:CountryCode"/>
            <to variable="InvokeInsertDeltaTSSOADBAdapterV1_IV" part="EngageSoaDeltatableCollection" query="/ns20:EngageSoaDeltatableCollection/ns20:EngageSoaDeltatable/ns20:countrycode"/>
          </copy>
          <copy>
            <from expression="bpws:getVariableData('InvokeSelectPALSTxnRecordDBAdapterV1_OV','Cc077Vs1CssordDtaCollection','/ns8:Cc077Vs1CssordDtaCollection/ns8:Cc077Vs1CssordDta[$dataCount]/ns8:deltaTs')"/>
            <to variable="InvokeInsertDeltaTSSOADBAdapterV1_IV" part="EngageSoaDeltatableCollection" query="/ns20:EngageSoaDeltatableCollection/ns20:EngageSoaDeltatable/ns20:palsDeltaTimestamp"/>
          </copy>
          <copy>
            <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:UserName"/>
            <to variable="InvokeInsertDeltaTSSOADBAdapterV1_IV" part="EngageSoaDeltatableCollection" query="/ns20:EngageSoaDeltatableCollection/ns20:EngageSoaDeltatable/ns20:updatedby"/>
          </copy>
          <copy>
            <from expression="xp20:current-dateTime()"/>
            <to variable="InvokeInsertDeltaTSSOADBAdapterV1_IV" part="EngageSoaDeltatableCollection" query="/ns20:EngageSoaDeltatableCollection/ns20:EngageSoaDeltatable/ns20:modifiedbytimestamp"/>
          </copy>
        </assign>
        <invoke name="InvokeInsertDeltaTSSOADBAdapterV1" inputVariable="InvokeInsertDeltaTSSOADBAdapterV1_IV" partnerLink="InsertDeltaTSSOADBAdapterV1" portType="ns19:InsertDeltaTSSOADBAdapterV1_ptt" operation="merge" bpelx:invokeAsDetail="no" id="BpInv11"/>
        <assign name="NextBatch" id="BpAss24">
          <copy>
            <from expression="bpws:getVariableData('batchCountIterator') + 1"/>
            <to variable="batchCountIterator"/>
          </copy>
        </assign>
      </sequence>
    </while>
    <switch name="Switch3" id="BpSwt4">
      <case condition="bpws:getVariableData('errorFlag') = 'true'">
        <bpelx:annotation>
          <bpelx:general>
            <bpelx:property name="userLabel">If Error Occured</bpelx:property>
          </bpelx:general>
        </bpelx:annotation>
        <sequence name="Sequence3" id="BpSeq16">
          <invoke name="InvokeSelectErrorRecordsSOAAdapterV1" inputVariable="InvokeSelectErrorRecordsSOAAdapterV1_IV" outputVariable="InvokeSelectErrorRecordsSOAAdapterV1_OV" partnerLink="SelectErrorRecordsSOADBAdapterV1" portType="ns13:SelectErrorRecordsSOADBAdapterV1_ptt" operation="SelectErrorRecordsSOADBAdapterV1" bpelx:invokeAsDetail="no" id="BpInv12"/>
          <assign name="Xform_ErrorData_to_ErrorDescription" id="BpAss25">
            <bpelx:annotation>
              <bpelx:pattern>transformation</bpelx:pattern>
            </bpelx:annotation>
            <copy>
              <from expression="ora:doXSLTransformForDoc('xsl/ErrorData_to_ErrorDescription.xsl', $InvokeSelectErrorRecordsSOAAdapterV1_OV.SelectErrorRecordsSOADBAdapterV1OutputCollection)"/>
              <to variable="InvokeInsertTxnHeaderSOAerrlogDBAdapterv1_IV" part="EngageSoaTxnheaderErrorlogCollection"/>
            </copy>
          </assign>
          <assign name="AssignCommonErrorHandlerValues" id="BpAss26">
            <copy>
              <from expression="ora:getCompositeInstanceId()"/>
              <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:InstanceID"/>
            </copy>
            <copy>
              <from expression="ora:getCompositeName()"/>
              <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:ComponentName"/>
            </copy>
            <copy>
              <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:InterfaceID"/>
              <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:ProjectID"/>
            </copy>
            <copy>
              <from expression="'E007PALSTransactionHeadertoPortal'"/>
              <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:ProjectName"/>
            </copy>
            <copy>
              <from expression="xp20:current-dateTime()"/>
              <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:Timestamp"/>
            </copy>
            <copy>
              <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:SenderSystem"/>
              <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:Source"/>
            </copy>
            <copy>
              <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:ReceiverSystem"/>
              <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:Target"/>
            </copy>
            <copy>
              <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:UserName"/>
              <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:UserID"/>
            </copy>
            <copy>
              <from expression="'BE-026'"/>
              <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorDetails/ns16:ErrorCode"/>
            </copy>
            <copy>
              <from expression="'Unable to process records.Records moved to SOA error log'"/>
              <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorDetails/ns16:ErrorSummary"/>
            </copy>
            <copy>
              <from expression="ora:getNodeValue(bpws:getVariableData('InvokeInsertTxnHeaderSOAerrlogDBAdapterv1_IV','EngageSoaTxnheaderErrorlogCollection','/ns17:EngageSoaTxnheaderErrorlogCollection'))"/>
              <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorDetails/ns16:ErrorDescription"/>
            </copy>
            <copy>
              <from expression="'E007_BE'"/>
              <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorNotification/ns16:LookupCriteria"/>
            </copy>
            <copy>
              <from expression="'Error while processing the records for the interface E007'"/>
              <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorNotification/ns16:Subject"/>
            </copy>
          </assign>
          <invoke name="InvokeCommonErrorHandler" inputVariable="InvokeCommonErrorHandler_IV" partnerLink="CommonErrorHandlerJMSAdapter" portType="ns14:Produce_Message_ptt" operation="Produce_Message" bpelx:invokeAsDetail="no" id="BpInv13"/>
          <assign name="Xform_SOAErrorREcords_to_EmailFlagUpdate" id="BpAss27">
            <bpelx:annotation>
              <bpelx:pattern>transformation</bpelx:pattern>
            </bpelx:annotation>
            <copy>
              <from expression="ora:doXSLTransformForDoc('xsl/SOAErrorREcords_to_EmailFlagUpdate.xsl', $InvokeSelectErrorRecordsSOAAdapterV1_OV.SelectErrorRecordsSOADBAdapterV1OutputCollection)"/>
              <to variable="InvokeUpdateEmailErrorFlagSOADBAdapterV1_IV" part="EngageSoaTxnheaderErrorlogCollection"/>
            </copy>
          </assign>
          <invoke name="InvokeUpdateEmailErrorFlagSOADBAdapterV1" inputVariable="InvokeUpdateEmailErrorFlagSOADBAdapterV1_IV" partnerLink="UpdateEmailErrorFlagSOADBAdapterV1" portType="ns18:UpdateEmailErrorFlagSOADBAdapterV1_ptt" operation="update" bpelx:invokeAsDetail="no" id="BpInv14"/>
        </sequence>
      </case>
    </switch>
    <switch name="Switch5" id="BpSwt5">
      <case condition="bpws:getVariableData('ReceiveTransactionHeaderReqMsg_IV','part1','/ns2:invocationMsg/ns2:LastInvokeFlag')='True'">
        <bpelx:annotation>
          <bpelx:general>
            <bpelx:property name="userLabel">If last invocation flag is set</bpelx:property>
          </bpelx:general>
        </bpelx:annotation>
        <sequence name="Sequence4" id="BpSeq17">
          <switch name="Switch7" id="BpSwt6">
            <case condition="(number(bpws:getVariableData('InvokeGetPALSDB2RecordCountDBAdapterV1_OV','GetPALSDB2RecordCountDBAdapterV1Output','/ns6:GetPALSDB2RecordCountDBAdapterV1Output/ns6:count')))-((number(bpws:getVariableData('ReceiveTransactionHeaderReqMsg_IV','part1','/ns2:invocationMsg/ns2:BatchSize')) * number(bpws:getVariableData('ReceiveTransactionHeaderReqMsg_IV','part1','/ns2:invocationMsg/ns2:BatchCount'))))>0">
              <bpelx:annotation>
                <bpelx:general>
                  <bpelx:property name="userLabel">If all records are not processed.</bpelx:property>
                </bpelx:general>
              </bpelx:annotation>
              <sequence name="Sequence5" id="BpSeq18">
                <assign name="AssignIncompletetransferError" id="BpAss28">
                  <copy>
                    <from expression="ora:getCompositeInstanceId()"/>
                    <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:InstanceID"/>
                  </copy>
                  <copy>
                    <from expression="ora:getCompositeName()"/>
                    <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:ComponentName"/>
                  </copy>
                  <copy>
                    <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:InterfaceID"/>
                    <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:ProjectID"/>
                  </copy>
                  <copy>
                    <from expression="'E007PALSTransactionHeadertoPortal'"/>
                    <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:ProjectName"/>
                  </copy>
                  <copy>
                    <from expression="xp20:current-dateTime()"/>
                    <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:Timestamp"/>
                  </copy>
                  <copy>
                    <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:SenderSystem"/>
                    <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:Source"/>
                  </copy>
                  <copy>
                    <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:ReceiverSystem"/>
                    <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:Target"/>
                  </copy>
                  <copy>
                    <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:UserName"/>
                    <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:CommonErrorData/ns16:UserID"/>
                  </copy>
                  <copy>
                    <from expression="'BE-027'"/>
                    <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorDetails/ns16:ErrorCode"/>
                  </copy>
                  <copy>
                    <from expression="'Incomplete data transfer.'"/>
                    <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorDetails/ns16:ErrorSummary"/>
                  </copy>
                  <copy>
                    <from expression="'Incomplete data transfer.'"/>
                    <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorDetails/ns16:ErrorDescription"/>
                  </copy>
                  <copy>
                    <from expression="'E007_BE'"/>
                    <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorNotification/ns16:LookupCriteria"/>
                  </copy>
                  <copy>
                    <from expression="'Error while processing the records for the interface E007'"/>
                    <to variable="InvokeCommonErrorHandler_IV" part="body" query="/ns16:ErrorInfo/ns16:ErrorNotification/ns16:Subject"/>
                  </copy>
                </assign>
                <invoke name="InvokeCommonErrorHandlerJMSAdapter" inputVariable="InvokeCommonErrorHandler_IV" partnerLink="CommonErrorHandlerJMSAdapter" portType="ns14:Produce_Message_ptt" operation="Produce_Message" bpelx:invokeAsDetail="no" id="BpInv15"/>
              </sequence>
            </case>
            <otherwise>
              <sequence id="BpSeq19">
                <switch name="Switch6" id="BpSwt7">
                  <case condition="count(bpws:getVariableData('InvokeSelectDeltaTSSOADBAdapterV1_OV','EngageSoaDeltatableCollection','/ns4:EngageSoaDeltatableCollection/ns4:EngageSoaDeltatable')) > 0">
                    <bpelx:annotation>
                      <bpelx:general>
                        <bpelx:property name="userLabel">If records are selected</bpelx:property>
                      </bpelx:general>
                    </bpelx:annotation>
                    <assign name="AssignPALSJMSNotificationDelta" id="BpAss29">
                      <copy>
                        <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:SenderSystem"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:SourceSystem"/>
                      </copy>
                      <copy>
                        <from expression="'Success'"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:ErrorFlag"/>
                      </copy>
                      <copy>
                        <from expression="'CC077VS1_CSSORD_DTA'"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:SourceTableName"/>
                      </copy>
                      <copy>
                        <from expression="'PRT_CARD_TRANSACTION_HEADER'"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:TargetTableName"/>
                      </copy>
                      <copy>
                        <from expression="xp20:current-dateTime()"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:NotificationDateTime"/>
                      </copy>
                      <copy>
                        <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:CountryCode"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:CountryCode"/>
                      </copy>
                      <copy>
                        <from variable="deltaDB2FormatTS"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:LastDeltaTimeStamp"/>
                      </copy>
                      <copy>
                        <from expression="'E007PALSTransactionHeadertoPortal'"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:InterfaceName"/>
                      </copy>
                      <copy>
                        <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:ReceiverSystem"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:TargetSystem"/>
                      </copy>
                      <copy>
                        <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:InterfaceID"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:InterfaceID"/>
                      </copy>
                    </assign>
                  </case>
                  <otherwise>
                    <assign name="AssignPALSJMSNotification" id="BpAss30">
                      <copy>
                        <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:SenderSystem"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:SourceSystem"/>
                      </copy>
                      <copy>
                        <from expression="'Success'"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:ErrorFlag"/>
                      </copy>
                      <copy>
                        <from expression="'CC077VS1_CSSORD_DTA'"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:SourceTableName"/>
                      </copy>
                      <copy>
                        <from expression="'PRT_CARD_TRANSACTION_HEADER'"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:TargetTableName"/>
                      </copy>
                      <copy>
                        <from expression="xp20:current-dateTime()"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:NotificationDateTime"/>
                      </copy>
                      <copy>
                        <from expression="bpws:getVariableData('InvokeSelectPALSTxnRecordDBAdapterV1_OV','Cc077Vs1CssordDtaCollection','/ns8:Cc077Vs1CssordDtaCollection/ns8:Cc077Vs1CssordDta[$dataCount]/ns8:deltaTs')"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:LastDeltaTimeStamp"/>
                      </copy>
                      <copy>
                        <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:CountryCode"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:CountryCode"/>
                      </copy>
                      <copy>
                        <from expression="'E007PALSTransactionHeadertoPortal'"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:InterfaceName"/>
                      </copy>
                      <copy>
                        <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:ReceiverSystem"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:TargetSystem"/>
                      </copy>
                      <copy>
                        <from variable="ReceiveTransactionHeaderReqMsg_IV" part="part1" query="/ns2:invocationMsg/ns2:InterfaceID"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:InterfaceID"/>
                      </copy>
                    </assign>
                  </otherwise>
                </switch>
                <switch name="Switch8" id="BpSwt8">
                  <case condition="bpws:getVariableData('errorFlag') = 'true'">
                    <assign name="AssignPALSNotifiactionWithError" id="BpAss31">
                      <copy>
                        <from expression="'Error'"/>
                        <to variable="InvokeSOAPALSNotifationJMSAdapter_IV" part="body" query="/ns22:Notification/ns22:ErrorFlag"/>
                      </copy>
                    </assign>
                  </case>
                </switch>
                <invoke name="InvokeSOAPALSNotifationJMSAdapter" inputVariable="InvokeSOAPALSNotifationJMSAdapter_IV" partnerLink="SOAPALSNotificationJMSAdapter" portType="ns21:Produce_Message_ptt" operation="Produce_Message" bpelx:invokeAsDetail="no" id="BpInv16"/>
              </sequence>
            </otherwise>
          </switch>
        </sequence>
      </case>
    </switch>
  </sequence>
</process><!--
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  Oracle JDeveloper BPEL Designer 
  
  Created: Wed May 14 12:47:56 IST 2014
  Author:  297792
  Type: BPEL 1.1 Process
  Purpose: Empty BPEL Process
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
-->